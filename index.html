<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LM:INDEPENDIENTES0.2</title>
   <style>
    body {
        font-family: 'Arial', sans-serif;
        margin: 0;
        padding: 20px;
        background: #f4f4f4;
        color: #333;
    }
    .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
        background: white;
        border-radius: 10px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
    }
    h2 {
        color: #00a9b5;
    }
    .form-inline {
        display: flex;
        flex-wrap: wrap;
        gap: 20px;
    }
    .form-group {
        flex: 1;
        min-width: 200px;
    }
    .form-group label {
        display: block;
        margin-bottom: 5px;
    }
    .form-group select, .form-group input {
        width: 100%;
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 5px;
    }
    .form-group button {
        padding: 10px 20px;
        background: #00a9b5;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
    }
    .form-group button:hover {
        background: #007BFF;
    }
    table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
    }
    table, th, td {
        border: 1px solid #ccc;
    }
    th, td {
        padding: 10px;
        text-align: center;
    }
    th {
        background: #00a9b5;
        color: white;
    }
    .user-info {
        margin-top: 20px;
        display: flex;
        flex-wrap: wrap;
        gap: 20px;
    }
    .user-info .form-group {
        flex: 1;
        min-width: 300px;
    }
    .date-container {
        margin-top: 20px;
    }
    .error {
        color: red;
        display: none;
    }
    .highlight {
        border-color: red;
    }
</style>

</head>
<body>
    <div class="container">
        <h2>Linguameeting</ch2>
        <h2>Solicitud de Remmplazos </h2>
        <div class="form-inline">
            <div class="form-group">
                <label for="date">Fecha:</label>
                <input type="date" id="date">
                <span id="dateError" class="error">Por favor, seleccione una fecha.</span>
            </div>
            <div class="form-group">
                <label for="coach">Coach Solicitante:</label>
                <select id="coach" onchange="populateFields()">
                    <option value="">Seleccione un coach</option>
                    <option value="Josue Avila">Josue Avila</option>
                    <option value="Magnolia Zuñiga">Magnolia Zuñiga</option>
                    <option value="Juan Rodríguez">Juan Rodríguez</option>
                    <option value="Daniela Fernandez">Daniela Fernandez</option>
                    <option value="Cristian Arriagada">Cristian Arriagada</option>
                    <option value="Edwin Juarez">Edwin Juarez</option>
                    <option value="Fernanda Ortiz">Fernanda Ortiz</option>
                    <option value="Valentina Cornejo">Valentina Cornejo</option>
                    
                </select>
                <span id="coachError" class="error">Por favor, seleccione un coach.</span>
            </div>
            <div class="form-group">
                <label for="country">País:</label>
                <select id="country">
                    <option value="">Seleccionar país</option>
                    <option value="España">España</option>
                    <option value="Panamá">Panamá</option>
                    <option value="EST">EST</option>
                    <option value="República Dominicana">República Dominicana</option>
                    <option value="Argentina">Argentina</option>
                    <option value="Costa Rica">Costa Rica</option>
                    <option value="Guatemala">Guatemala</option>
                    <option value="Nicaragua">Nicaragua</option>
                    <option value="Chile">Chile</option>
                </select>
                <span id="countryError" class="error">Por favor, seleccione un país.</span>
            </div>
        </div>
        <div class="form-group">
            <label for="hours">Horas:</label>
            <input type="time" id="hours">
            <span id="hoursError" class="error">Por favor, ingrese una hora.</span>
            <button onclick="addHour()">Agregar Hora</button>
            <button onclick="showDeleteHourOptions()">Eliminar Hora</button>
            <button onclick="clearHours()">Limpiar</button>
        </div>
        <div class="form-group" id="deleteOptions" style="display: none;">
            <label for="deleteHour">Seleccionar Hora para Eliminar:</label>
            <select id="deleteHour"></select>
            <button onclick="removeSelectedHours()">Eliminar Selección</button>
        </div>
            <select id="duracion">
                <option value="">Duración</option>
                <option value="15">15 minutos</option>
                <option value="30">30 minutos</option>
                <option value="45">45 minutos</option>
            </select>
        </div>...
        <div class="form-group">
    <label for="note">Nota para el Coach de Reemplazo</label>
    <textarea id="note" rows="4" placeholder="Escribe una nota para el coach de reemplazo aquí..." style="width: 100%;"></textarea>
</div>

        <table id="hoursTable">
            <thead>
                <tr>
                    <th>Hora</th>
                    <th>Duración</th>
                    <th>Coach de Reemplazo</th>
                    <th>Tipo de Reemplazo</th>
                    <th>España</th>
                    <th>Panamá</th>
                    <th>EST</th>
                    <th>República Dominicana</th>
                    <th>Argentina</th>
                    <th>Costa Rica</th>
                    <th>Guatemala</th>
                    <th>Nicaragua</th>
                    <th>Chile</th>
                    <th>Fecha de Reemplazo</th>
                </tr>
            </thead>
            <tbody>
                <!-- Las filas se agregarán dinámicamente -->
            </tbody>
        </table>
        <div class="user-info">
            <div class="form-group">
                <label for="portal">Portal</label>
                <input type="text" id="portal" placeholder="Portal" readonly>
            </div>
            <div class="form-group">
                <label for="password">Contraseña</label>
                <input type="text" id="password" placeholder="Contraseña" readonly>
            </div>
            <div class="form-group">
                <label for="zoom">Zoom</label>
                <input type="text" id="zoom" placeholder="Zoom" readonly>
            </div>
            <div class="form-group">
                <label for="zoomPassword">Contraseña (Zoom)</label>
                <input type="text" id="zoomPassword" placeholder="Contraseña de Zoom" readonly>
            </div>
            <div class="form-group">
                <label for="emergencyRoom">Sala de Emergencia</label>
                <a id="emergencyRoomLink" href="#" target="_blank" style="display:none;">Abrir Sala de Emergencia</a>
                <input type="text" id="emergencyRoom" placeholder="Sala de Emergencia" readonly style="display:none;">
            </div>
            
        </div>
        <div class="form-group">
            <button onclick="saveData()">Guardar</button>
            <button onclick="sharch()">Buscar</button>
            <button onclick="saveData()">Reemplazar</button>
        </div>
    </div>

    <script>

        // Diferencias horarias para cada país en horas
        const timeZones = {
            'España': 2,
            'Panamá': -5,
            'EST': -4,
            'República Dominicana': -4,
            'Argentina': -3,
            'Costa Rica': -6,
            'Guatemala': -6,
            'Nicaragua': -6,
            'Chile': -4
        };

        // Datos de ejemplo para coaches (reemplaza esto con datos reales)
        const coachData = {
            'Josue Avila': { portal: 'josueavilaantigua2022@outlook.com', password: 'linguameeting', zoom: 'josueavilaantigua2022@outlook.com', zoomPassword: 'Avila2022', emergencyRoom: 'https://linguameeting.zoom.us/j/91058372053?pwd=ZWl2bzJTZ0FndGhCNk1FWVc2UGhRUT09' },
            'Magnolia Zuñiga': { portal: 'maggyzvillalta@gmail.com', password: 'Magnoliazv555', zoom: 'maggyzvillalta@gmail.com', zoomPassword: 'Magnoliazv555', emergencyRoom: 'https://linguameeting.zoom.us/j/91058372053?pwd=ZWl2bzJTZ0FndGhCNk1FWVc2UGhRUT09' },
            'Juan Rodríguez': { portal: 'jdwork1702@gmail.com', password: 'Balboa789!', zoom: 'juanrodriguezlm2023@gmail.com', zoomPassword: 'Linguameeting2023', emergencyRoom: 'https://linguameeting.zoom.us/j/94390800576?pwd=WVZXcklDVHB6NFlma1RxdHMvcnlvZz09' },
            'Daniela Fernandez': { portal: 'dafni184619@gmail.com', password: 'R4nses2211!', zoom: 'dafni184619@gmail.com', zoomPassword: 'R4nses2211!', emergencyRoom: 'https://linguameeting.zoom.us/j/96784838803?pwd=Tyt5RFNidFA2MjdWSFd0bGtxaDJ6dz09' },
            'Cristian Arriagada': { portal: 'cristian.arriagada1@mail.udp.cl', password: '28Julio1996!', zoom: 'cristian.arriagada1@mail.udp.cl', zoomPassword: '28Julio1996!', emergencyRoom: 'No entregada' },
            'Edwin Juarez': { portal: 'edujuarez0511@gmail.com', password: 'Danilo.0511$$', zoom: 'edujuarez0511@gmail.com', zoomPassword: 'Danilo.0511$$', emergencyRoom: 'No entregada' },
            'Fernanda Ortiz': { portal: 'ortizcortezfernanda7@gmail.com', password: 'Fernandita2002&', zoom: 'ortizcortezfernanda7@gmail.com', zoomPassword: 'fernandita2002', emergencyRoom: 'No entregada' },
            'Valentina Cornejo': { portal: 'moonsomnia@hotmail.com', password: 'GrahamVelasco123#', zoom: 'moonsomnia@hotmail.com', zoomPassword: 'kariyamasaki1', emergencyRoom: 'No entregada' }
            
        };
        async function saveDataToAirtable() {
    const apiKey = "pate46z80NgVp1vRd.bb3fc4fe978d88cc84cc149a104abc022c5487482fe07af2a0d350fa8f8f2e71";
    const baseId = "pate46z80NgVp1vRd";
    const tableName = "Independientes 0.2";

    let coach = document.getElementById('coach').value;
    let date = document.getElementById('date').value;
    let rows = document.getElementById('hoursTable').getElementsByTagName('tbody')[0].rows;

    let records = Array.from(rows).map(row => {
        return {
            "fields": {
                "Fecha": date,
                "Coach Solicitante": coach,
                "País": país,
                "Hora": row.cells[0].innerText,
                "Duración": row.cells[1].innerText,
                "Coach de Reemplazo": coachdereemplazo,
                "Tipo de Reemplazo": tipodereemplazo,
                "Nota": nota,
                "Fecha": date,

                // Campos de datos que se guardaran
            }
        };
    });

    let response = await fetch(`https://api.airtable.com/v0/${appVuMTXFU8YHrGND}/${Independientes}`, {
        method: 'POST',
        headers: {
            'Authorization': `Bearer ${apiKey}`,
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({ records })
    });

    if (response.ok) {
        alert("Datos guardados en Airtable");
    } else {
        alert("Error al guardar en Airtable");
    }
    function saveData() {
    const coach = document.getElementById('coach').value;
    const date = document.getElementById('date').value;
    const country = document.getElementById('country').value;
    const hours = document.getElementById('hours').value;

    if (!coach || !date || !country || !hours) {
        alert('Por favor, complete todos los campos.');
        return;
    }

    const data = {
        fields: {
            "Coach": coach,
            "Fecha": date,
            "País": country,
            "Hora": hours,
        }
    };

    fetch("https://api.airtable.com/v0/BASE_ID/TABLE_NAME", {
        method: "POST",
        headers: {
            "Authorization": "Bearer API_KEY",
            "Content-Type": "application/json"
        },
        body: JSON.stringify(data)
    })
    .then(response => response.json())
    .then(data => {
        console.log("Datos guardados:", data);
        alert("Datos guardados exitosamente.");
    })
    .catch(error => {
        console.error("Error al guardar los datos:", error);
        alert("Ocurrió un error al guardar los datos.");
    });
}

}


        function populateFields() {
    const selectedCoach = document.getElementById('coach').value;
    if (selectedCoach && coachData[selectedCoach]) {
        document.getElementById('portal').value = coachData[selectedCoach].portal;
        document.getElementById('password').value = coachData[selectedCoach].password;
        document.getElementById('zoom').value = coachData[selectedCoach].zoom;
        document.getElementById('zoomPassword').value = coachData[selectedCoach].zoomPassword;

        const emergencyRoomLink = document.getElementById('emergencyRoomLink');
        const emergencyRoomInput = document.getElementById('emergencyRoom');
        const emergencyRoomURL = coachData[selectedCoach].emergencyRoom;

        if (emergencyRoomURL && emergencyRoomURL !== 'No entregada') {
            emergencyRoomLink.href = emergencyRoomURL;
            emergencyRoomLink.style.display = 'block';
            emergencyRoomInput.style.display = 'none';
        } else {
            emergencyRoomInput.value = emergencyRoomURL;
            emergencyRoomInput.style.display = 'block';
            emergencyRoomLink.style.display = 'none';
        }
    }
}
function addHour() {
    const date = document.getElementById('date').value;
    const coach = document.getElementById('coach').value;
    const country = document.getElementById('country').value;
    const hours = document.getElementById('hours').value;
    const duration = document.getElementById('duracion').value; // Obtener duración

    // Validación de los campos
    if (!date || !coach || !country || !hours || !duration) {
        if (!date) document.getElementById('dateError').style.display = 'block';
        if (!coach) document.getElementById('coachError').style.display = 'block';
        if (!country) document.getElementById('countryError').style.display = 'block';
        if (!hours) document.getElementById('hoursError').style.display = 'block';
        if (!duration) document.getElementById('duracion').style.borderColor = 'red'; // Agregar error visual para duración
        return;
    } else {
        document.getElementById('dateError').style.display = 'none';
        document.getElementById('coachError').style.display = 'none';
        document.getElementById('countryError').style.display = 'none';
        document.getElementById('hoursError').style.display = 'none';
        document.getElementById('duracion').style.borderColor = ''; // Limpiar error visual para duración
    }

    const adjustedTimes = adjustTime(hours, country);

    const newRow = document.createElement('tr');
    newRow.innerHTML = `
        <td>${hours}</td>
        <td>${duration} minutos</td> <!-- Agregar duración -->
        <td>
            <select class="coachSelect">
                <option value="No Remplazo">Sin Reemplazo</option>
                <option value="Josue Avila">Josue Avila</option>
                <option value="Magnolia Zuñiga">Magnolia Zuñiga</option>
                <option value="Juan Rodríguez">Juan Rodríguez</option>
                <option value="Daniela Fernandez">Daniela Fernandez</option>
                <option value="Cristian Arriagada">Cristian Arriagada</option>
                <option value="Edwin Juarez">Edwin Juarez</option>
                <option value="Fernanda Ortiz">Fernanda Ortiz</option>
                <option value="Valentina Cornejo">Valentina Cornejo</option>
                <option value="Valde Pie">Valde Pie</option>
                <option value="Otro">Otro</option>
            </select>
            <input type="text" class="newCoachName" placeholder="Ingrese nuevo nombre" style="display: none;">
        </td>
        <td>
            <select>
                <option value="Interno">Interno</option>
                <option value="Externo">Externo</option>
            </select>
        </td>
        <td>${adjustedTimes['España']}</td>
        <td>${adjustedTimes['Panamá']}</td>
        <td>${adjustedTimes['EST']}</td>
        <td>${adjustedTimes['República Dominicana']}</td>
        <td>${adjustedTimes['Argentina']}</td>
        <td>${adjustedTimes['Costa Rica']}</td>
        <td>${adjustedTimes['Guatemala']}</td>
        <td>${adjustedTimes['Nicaragua']}</td>
        <td>${adjustedTimes['Chile']}</td>
        <td>${date}</td>
    `;

    // Maneja la selección en la lista desplegable
    document.addEventListener('change', function(e) {
        if (e.target.classList.contains('coachSelect')) {
            const select = e.target;
            const newCoachInput = select.nextElementSibling;
            
            if (select.value === 'Otro') {
                newCoachInput.style.display = 'inline';
                newCoachInput.focus();
            } else {
                newCoachInput.style.display = 'none';
            }
        }
    });

    // Maneja el campo de entrada para nuevos nombres
    document.addEventListener('blur', function(e) {
        if (e.target.classList.contains('newCoachName')) {
            const newCoachName = e.target.value.trim();
            const select = e.target.previousElementSibling;
            
            if (newCoachName && !Array.from(select.options).some(option => option.value === newCoachName)) {
                const newOption = document.createElement('option');
                newOption.value = newCoachName;
                newOption.textContent = newCoachName;
                select.add(newOption);
                select.value = newCoachName; // Selecciona el nuevo nombre
            }
           
            
        }
        
    }, true);

    document.getElementById('hoursTable').querySelector('tbody').appendChild(newRow);

    // Actualizar la lista de horas disponibles para eliminar
    const deleteHourSelect = document.getElementById('deleteHour');
    const option = document.createElement('option');
    option.value = hours;
    option.textContent = hours;
    deleteHourSelect.appendChild(option);
}


// Maneja el campo de entrada para nuevos nombres
document.addEventListener('blur', function(e) {
    if (e.target.classList.contains('newCoachName')) {
        const newCoachName = e.target.value.trim();
        const select = e.target.previousElementSibling;
        
        if (newCoachName && !Array.from(select.options).some(option => option.value === newCoachName)) {
            const newOption = document.createElement('option');
            newOption.value = newCoachName;
            newOption.textContent = newCoachName;
            select.add(newOption);
            select.value = newCoachName; // Selecciona el nuevo nombre
        }
        e.target.value = ''; // Limpiar el campo de entrada
        e.target.style.display = 'none';
        
    }
}, true);

            document.getElementById('hoursTable').querySelector('tbody').appendChild(newRow);

            // Actualizar la lista de horas disponibles para eliminar
            const deleteHourSelect = document.getElementById('deleteHour');
            const newOption = document.createElement('option');
            newOption.value = hours;
            newOption.text = hours;
            deleteHourSelect.add(newOption);
            deleteDuracionSelect.add(newOption);

        function adjustTime(time, country) {
            const result = {};
            const [hours, minutes] = time.split(':').map(Number);

            // Hora base en UTC del país seleccionado
            const baseTime = new Date();
            baseTime.setUTCHours(hours - timeZones[country], minutes);

            for (const [countryName, offset] of Object.entries(timeZones)) {
                const localTime = new Date(baseTime);
                localTime.setUTCHours(localTime.getUTCHours() + offset);

                // Formatear horas y minutos para asegurarse de que tengan dos dígitos
                const localHours = String(localTime.getUTCHours()).padStart(2, '0');
                const localMinutes = String(localTime.getUTCMinutes()).padStart(2, '0');

                result[countryName] = `${localHours}:${localMinutes}`;
            }

            return result;
        }

        function showDeleteHourOptions() {
            document.getElementById('deleteOptions').style.display = 'block';
        }

        function removeSelectedHours() {
            const deleteHourSelect = document.getElementById('deleteHour');
            const selectedHour = deleteHourSelect.value;

            if (selectedHour) {
                // Eliminar la fila de la tabla
                const rows = document.getElementById('hoursTable').querySelectorAll('tbody tr');
                for (const row of rows) {
                    if (row.cells[0].textContent === selectedHour) {
                        row.remove();
                        break;
                    }
                }

                // Eliminar la opción del select
                deleteHourSelect.remove(deleteHourSelect.selectedIndex);
            }
            
        }

        function clearHours() {
        }

function clearHours() {
    const table = document.getElementById('hoursTable');
    while (table.rows.length > 1) {
        table.deleteRow(1);
    }
            document.getElementById('date').value = '';
            document.getElementById('coach').value = '';
            document.getElementById('country').value = '';
            document.getElementById('hours').value = '';
            document.getElementByID('duración').value=  '';
            
        }

    

async function saveDataToAirtable() {
    const apiKey = "pate46z80NgVp1vRd.bb3fc4fe978d88cc84cc149a104abc022c5487482fe07af2a0d350fa8f8f2e71";
    const baseId = "appnIdxIuAdZLiYcX";  // Asegúrate de que el ID de la base sea correcto
    const tableName = "Independientes 0.2";

    let coach = document.getElementById('coach').value;
    let date = document.getElementById('date').value;
    let country = document.getElementById('country').value;
    let note = document.getElementById('note').value;

    
    let rows = document.getElementById('hoursTable').getElementsByTagName('tbody')[0].rows;
    let records = Array.from(rows).map(row => {
        return {
            "fields": {
                "Fecha": date,
                "Coach Solicitante": coach,
                "País": country,
                "Coach de Reemplazo": row.cells[2].getElementsByTagName('select')[0].value,
                "Hora": row.cells[0].innerText,
                "Duración": row.cells[1].innerText,
                "Tipo de Reemplazo": row.cells[3].getElementsByTagName('select')[0].value,
                "Nota": note
            }
        };
    });

    let response = await fetch(`https://api.airtable.com/v0/${baseId}/${tableName}`, {
        method: 'POST',
        headers: {
            'Authorization': `Bearer ${apiKey}`,
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({ records })
    });

    if (response.ok) {
        alert("Datos guardados en Airtable");
    } else {
        alert("Error al guardar en Airtable"); 999999999999
    }
}

async function saveData() {
    // Obtén los valores de los campos del formulario
    const coach = document.getElementById('coach').value;
    const portal = document.getElementById('portal').value;
    const password = document.getElementById('password').value;
    const zoom = document.getElementById('zoom').value;
    const zoomPassword = document.getElementById('zoomPassword').value;
    const emergencyRoom = document.getElementById('emergencyRoom').value;

    // Prepara los datos para enviar
    const recordData = {
        fields: {
            "Coach": coach,
            "Portal": portal,
            "Password": password,
            "Zoom": zoom,
            "Zoom Password": zoomPassword,
            "Emergency Room": emergencyRoom,
        }
    };

    try {
        // Realiza la solicitud POST a la API de Airtable
        const response = await fetch('https://api.airtable.com/v0/appVuMTXFU8YHrGND/Independientes%200.2', {
            method: 'POST',
            headers: {
                'Authorization': 'Bearer patWD3M1Wi1RE07no.d8306748fbe7131f6bbee94fb6eba4b7a60678ea4d7ce636f7fb4dec45320dab',
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(recordData)
        });

        // Manejo de respuesta
        if (response.ok) {
            const data = await response.json();
            alert('Datos guardados con éxito.');
            console.log('Datos guardados:', data); // Verifica los datos guardados
        } else {
            const errorData = await response.json();
            console.error('Error al guardar los datos:', errorData);
            alert('Error al guardar los datos.');
        }
    } catch (error) {
        console.error('Error:', error);
        alert('Error al guardar los datos.');
    }
}

        // Función para buscar datos en Airtable
        async function search() {
            const coach = document.getElementById('coach').value;

            try {
                const response = await fetch(`https://api.airtable.com/v0/BASE_ID/TABLE_NAME?filterByFormula={Coach}='${coach}'`, {
                    headers: {
                        'Authorization': 'Bearer patvoxrpeFrhVOZrv',
                    }
                });

                if (response.ok) {
                    const data = await response.json();
                    if (data.records.length > 0) {
                        const record = data.records[0].fields;
                        document.getElementById('portal').value = record.Portal;
                        document.getElementById('password').value = record.Password;
                        document.getElementById('zoom').value = record.Zoom;
                        document.getElementById('zoomPassword').value = record["Zoom Password"];
                        document.getElementById('emergencyRoom').value = record["Emergency Room"];
                    } else {
                        alert('No se encontraron datos para el coach seleccionado.');
                    }
                } else {
                    alert('Error al buscar los datos.');
                }
            } catch (error) {
                console.error('Error:', error);
                alert('Error al buscar los datos.');
            }
        }
    


        function searchData() {
            // Implementar lógica para buscar los datos
            alert('Búsqueda realizada.');
        }
        const express = require('express');
const path = require('path');
const app = express();
const port = 3000;

// Sirve los archivos estáticos (HTML, CSS, JS)
app.use(express.static(path.join(__dirname, 'public')));

// Ruta principal para servir tu archivo HTML
app.get('/', (req, res) => {
    res.sendFile(path.join(__dirname, 'public', 'index.html'));
});

// Inicia el servidor
app.listen(port, () => {
    console.log(`Server running on http://localhost:${port}`);
});


    </script>
</body>
</html>
