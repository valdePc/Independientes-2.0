<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LM:INDEPENDIENTES0.2</title>
    <style>
 .logo {
        margin: 0;
        padding: 0;
        text-align: center;
    }

    .logo img {
        display: block;
        margin: 0 auto;
        padding: 0;
    }

    .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px 20px 0 20px; /* Reduce el padding inferior */
        background: white;
        border-radius: 10px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
    }

    h2 {
        margin-top: 10px; /* Reduce el margen superior del título */
        color: #00a9b5;
    }
        
body {
    font-family: 'Arial', sans-serif;
    margin: 0;
    padding: 20px;
    background: #f4f4f4;
    color: #333;
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
}

.container {
    width: 100%;
    max-width: 100%;
    margin: 0 auto;
    padding: 30px;
    background: white; /* Fondo blanco */
    border-radius: 20px;
    box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1), 0 6px 6px rgba(0, 0, 0, 0.1);
    overflow: auto; /* Permitir desplazamiento */
}

h2 {
    color: #00a9b5;
    font-size: 2rem;
    text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.2);
    margin-bottom: 20px;
}

.form-inline {
    display: flex;
    flex-wrap: wrap;
    gap: 20px;

    form-inline .form-group {
    flex: 1;
    min-width: 200px;
    margin-right: 20px; /* Ajusta el espacio entre los campos */
}

#date {
    width: calc(100% - 40px); /* Reduce el ancho del campo de fecha */
    padding: 10px;
    border: 1px solid #ccc;
    border-radius: 5px;
}
}

.form-group {
    flex: 1;
    min-width: 200px;
    margin-bottom: 15px;
}

.form-group label {
    display: block;
    margin-bottom: 5px;
    font-weight: bold;
    color: #00a9b5;
}

.form-group select,
.form-group input {
    width: 100%;
    padding: 12px;
    border: 1px solid #ccc;
    border-radius: 10px;
    box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.1);
    transition: box-shadow 0.3s ease, border-color 0.3s ease;
    background: white; /* Fondo blanco */
}

.form-group select:focus,
.form-group input:focus {
    box-shadow: 0 0 10px rgba(0, 169, 181, 0.5);
    border-color: #00a9b5;
    outline: none;
}

.form-group button {
    padding: 12px 20px;
    background: #00a9b5;
    color: white;
    border: none;
    border-radius: 10px;
    cursor: pointer;
    box-shadow: 0 8px 15px rgba(0, 169, 181, 0.4);
    transition: background 0.3s ease, box-shadow 0.3s ease, transform 0.3s ease;
}

.form-group button:hover {
    background: #007b8f;
    box-shadow: 0 12px 25px rgba(0, 169, 181, 0.5);
    transform: translateY(-3px);
}

table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 30px;
    background: white; /* Fondo blanco */
    border-radius: 10px;
    overflow: hidden;
    box-shadow: 0 8px 15px rgba(0, 0, 0, 0.1);
    min-width: 1200px; /* Asegura que la tabla tenga un ancho mínimo */
}

table, th, td {
    border: 1px solid #ddd;
}

th, td {
    padding: 15px;
    text-align: center;
    transition: background 0.3s ease;
}

th {
    background: #00a9b5;
    color: white;
}

th:hover {
    background: #007b8f;
}

td:hover {
    background: #f0f8ff;
}

.user-info {
    margin-top: 30px;
    display: flex;
    flex-wrap: wrap;
    gap: 20px;
}

.user-info .form-group {
    flex: 1;
    min-width: 300px;
}

.error {
    color: red;
    display: none;
    font-weight: bold;
}

.highlight {
    border-color: red;
}

@media (max-width: 768px) {
    .container {
        padding: 20px;
    }

    h2 {
        font-size: 1.5rem;
    }

    .form-group button {
        padding: 10px 20px;
    }
}

    </style>
</head>
<body>
    <div class="container">
        <div class="container">
            <div class="logo">
                <img src="images/Copia_de_Nuevos_fondos_2023-removebg-preview.png" alt="Logo de Linguameeting">
            </div>
        <h2>Independientes 1.0</h2>
        <div class="form-inline">
            <div class="form-group">
                <label for="date">Fecha:</label>
                <input type="date" id="date">
                <span id="dateError" class="error">Por favor, seleccione una fecha.</span>
            </div>
            <div class="form-group">
                <label for="coach">Coach Solicitante:</label>
                <select id="coach" onchange="populateFields()">
                    <option value="">Seleccione un coach</option>
                    <option value="Lara Bravo">Lara Bravo</option>
                    <option value="Selene Cidoncha">Selene Cidoncha</option>
                    <option value="Eduaardo vaz">Eduaardo vaz>
                    <option value="Camila Muñoz">Daniela Fernandez</option>
                    <option value="Alejandro Alvarez">Alejandro Alvarez</option>
                    <option value="Miriam Bautista">Miriam Bautista</option>
                    <option value="Karla Guel">Karla Guel</option>
                    <option value="Zachechy Sanchez">Zachechy Sanchez</option>
                    <option value="Inovis cortez">Inovis cortez</option>
                    <option value="Ileana Plata">Ileana Plata</option>
                    <option value="Nelson Guido">Nelson Guido</option>
                    <option value="Sofia Gutierrez">Sofia Gutierrez</option>
                </select>
                <span id="coachError" class="error">Por favor, seleccione un coach.</span>
            </div>
            <div class="form-group">
                <label for="country">País:</label>
                <select id="country">
                    <option value="">Seleccionar país</option>
                    <option value="España">España</option>
                    <option value="Panamá">Panamá</option>
                    <option value="EST">EST</option>
                    <option value="República Dominicana">República Dominicana</option>
                    <option value="Argentina">Argentina</option>
                    <option value="Costa Rica">Costa Rica</option>
                    <option value="Guatemala">Guatemala</option>
                    <option value="Nicaragua">Nicaragua</option>
                    <option value="Chile">Chile</option>
                </select>
                <span id="countryError" class="error">Por favor, seleccione un país.</span>
            </div>
        </div>
        <div class="form-group">
            <label for="hours">Horas:</label>
            <input type="time" id="hours">
            <span id="hoursError" class="error">Por favor, ingrese una hora.</span>
            <button onclick="addHour()">Agregar Hora</button>
            <button onclick="showDeleteHourOptions()">Eliminar Hora</button>
            <button onclick="clearHours()">Limpiar</button>
        </div>
        <div class="form-group" id="deleteOptions" style="display: none;">
            <label for="deleteHour">Seleccionar Hora para Eliminar:</label>
            <select id="deleteHour"></select>
            <button onclick="removeSelectedHours()">Eliminar Selección</button>
        </div>
        <select id="duracion">
            <option value="">Duración</option>
            <option value="15">15 minutos</option>
            <option value="30">30 minutos</option>
            <option value="45">45 minutos</option>
        </select>
        <div class="form-group">
            <label for="note">Nota para el Coach de Reemplazo</label>
            <textarea id="note" rows="4" placeholder="Escribe una nota para el coach de reemplazo aquí..." style="width: 100%;"></textarea>
            
        </div>
        <table id="hoursTable">
            <thead>
                <tr>
                    <th>Hora</th>
                    <th>Duración</th>
                    <th>Coach de Reemplazo</th>
                    <th>Tipo de Reemplazo</th>
                    <th>España</th>
                    <th>Panamá</th>
                    <th>EST</th>
                    <th>República Dominicana</th>
                    <th>Argentina</th>
                    <th>Costa Rica</th>
                    <th>Guatemala</th>
                    <th>Nicaragua</th>
                    <th>Chile</th>
                    <th>Fecha de Reemplazo</th>
                </tr>
            </thead>
            <tbody>
                <!-- Las filas se agregarán dinámicamente -->
            </tbody>
        </table>
        <div class="user-info">
            <div class="form-group">
                <label for="portal">Portal</label>
                <input type="text" id="portal" placeholder="Portal" readonly>
            </div>
            <div class="form-group">
                <label for="password">Contraseña</label>
                <input type="text" id="password" placeholder="Contraseña" readonly>
            </div>
            <div class="form-group">
                <label for="zoom">Zoom</label>
                <input type="text" id="zoom" placeholder="Zoom" readonly>
            </div>
            <div class="form-group">
                <label for="zoomPassword">Contraseña (Zoom)</label>
                <input type="text" id="zoomPassword" placeholder="Contraseña de Zoom" readonly>
            </div>
            <div class="form-group">
                <label for="emergencyRoom">Sala de Emergencia</label>
                <a id="emergencyRoomLink" href="#" target="_blank" style="display:none;">Abrir Sala de Emergencia</a>
                <input type="text" id="emergencyRoom" placeholder="Sala de Emergencia" readonly style="display:none;">
            </div>
        </div>
        <div class="form-group">
            <button onclick="saveData()">Guardar</button>
            <button onclick="searchRecords()">Buscar</button>
            <button onclick="replaceData()">Reemplazar</button>
        </div>
    </div>

    <script>
        const timeZones = {
            'España': 2,
            'Panamá': -5,
            'EST': -4,
            'República Dominicana': -4,
            'Argentina': -3,
            'Costa Rica': -6,
            'Guatemala': -6,
            'Nicaragua': -6,
            'Chile': -4
        };

        const coachData = {
            'Josue Avila': { portal: 'josueavilaantigua2022@outlook.com', password: 'linguameeting', zoom: 'josueavilaantigua2022@outlook.com', zoomPassword: 'Avila2022', emergencyRoom: 'https://linguameeting.zoom.us/j/91058372053?pwd=ZWl2bzJTZ0FndGhCNk1FWVc2UGhRUT09' },
            'Magnolia Zuñiga': { portal: 'maggyzvillalta@gmail.com', password: 'Magnoliazv555', zoom: 'maggyzvillalta@gmail.com', zoomPassword: 'Magnoliazv555', emergencyRoom: 'https://linguameeting.zoom.us/j/91058372053?pwd=ZWl2bzJTZ0FndGhCNk1FWVc2UGhRUT09' },
            'Juan Rodríguez': { portal: 'jdwork1702@gmail.com', password: 'Balboa789!', zoom: 'juanrodriguezlm2023@gmail.com', zoomPassword: 'Linguameeting2023', emergencyRoom: 'https://linguameeting.zoom.us/j/94390800576?pwd=WVZXcklDVHB6NFlma1RxdHMvcnlvZz09' },
            'Daniela Fernandez': { portal: 'dafni184619@gmail.com', password: 'R4nses2211!', zoom: 'dafni184619@gmail.com', zoomPassword: 'R4nses2211!', emergencyRoom: 'https://linguameeting.zoom.us/j/96784838803?pwd=Tyt5RFNidFA2MjdWSFd0bGtxaDJ6dz09' },
            'Cristian Arriagada': { portal: 'cristian.arriagada1@mail.udp.cl', password: '28Julio1996!', zoom: 'cristian.arriagada1@mail.udp.cl', zoomPassword: '28Julio1996!', emergencyRoom: 'https://linguameeting.zoom.us/j/99032698699?pwd=TdJeJBJNu20PznWPRj8Fo5amyaTxYB.1' },
            'Edwin Juarez': { portal: 'edujuarez0511@gmail.com', password: 'Danilo.0511$$', zoom: 'edujuarez0511@gmail.com', zoomPassword: 'Danilo.0511$$', emergencyRoom: 'https://linguameeting.zoom.us/j/98512648322?pwd=dms4VGd4V2FCL0ZkWSt6MUUwZ29vdz09' },
            'Fernanda Ortiz': { portal: 'ortizcortezfernanda7@gmail.com', password: 'Fernandita2002&', zoom: 'ortizcortezfernanda7@gmail.com', zoomPassword: 'fernandita2002', emergencyRoom: 'https://linguameeting.zoom.us/j/95638745486?pwd=ayIYgKyXMarDZFBIPUGp8xO0qS7ea0.1' },
            'Valentina Cornejo': { portal: 'moonsomnia@hotmail.com', password: 'GrahamVelasco123#', zoom: 'moonsomnia@hotmail.com', zoomPassword: 'kariyamasaki1', emergencyRoom: 'https://linguameeting.zoom.us/j/98815343064?pwd=z0TU1oKoqtIVYbDs1bymsOWGRdOi4t.1' },
            'Leandro Rioja': { portal: 'lrioja02@gmail.com', password: 'Le@n2002', zoom: 'lrioja02@gmail.com', zoomPassword: 'Lean2002', emergencyRoom: 'https://linguameeting.zoom.us/j/6882524640?pwd=BPb4TN8diEMo4AcPkUcphZKMErV9yE.1' }
            
        };

       function populateFields() {
    const selectedCoach = document.getElementById('coach').value;

    if (selectedCoach === "") {
        // Si no se selecciona un coach, limpiar todos los campos
        clearFields();
    } else if (coachData[selectedCoach]) {
        // Si se selecciona un coach, llenar los campos correspondientes
        document.getElementById('portal').value = coachData[selectedCoach].portal;
        document.getElementById('password').value = coachData[selectedCoach].password;
        document.getElementById('zoom').value = coachData[selectedCoach].zoom;
        document.getElementById('zoomPassword').value = coachData[selectedCoach].zoomPassword;

        const emergencyRoomLink = document.getElementById('emergencyRoomLink');
        const emergencyRoomInput = document.getElementById('emergencyRoom');
        const emergencyRoomURL = coachData[selectedCoach].emergencyRoom;

        if (emergencyRoomURL && emergencyRoomURL !== 'No entregada') {
            emergencyRoomLink.href = emergencyRoomURL;
            emergencyRoomLink.style.display = 'block';
            emergencyRoomInput.style.display = 'none';
        } else {
            emergencyRoomInput.value = emergencyRoomURL;
            emergencyRoomInput.style.display = 'block';
            emergencyRoomLink.style.display = 'none';
        }
    } else {
        // Si el coach seleccionado no está en coachData, limpiar los campos también
        clearFields();
    }
}

function clearFields() {
    // Limpiar campos básicos
    document.getElementById('portal').value = '';
    document.getElementById('password').value = '';
    document.getElementById('zoom').value = '';
    document.getElementById('zoomPassword').value = '';
    document.getElementById('emergencyRoom').value = '';
    document.getElementById('emergencyRoomLink').href = '#';
    document.getElementById('emergencyRoomLink').style.display = 'none';
    document.getElementById('emergencyRoom').style.display = 'block';

    // Limpiar campos adicionales
    document.getElementById('date').value = '';
    document.getElementById('coach').value = '';
    document.getElementById('country').value = '';
    document.getElementById('hours').value = '';
    document.getElementById('duracion').value = '';
    document.getElementById('note').value = '';

    // Limpiar las filas de la tabla
    const tableBody = document.getElementById('hoursTable').querySelector('tbody');
    while (tableBody.firstChild) {
        tableBody.removeChild(tableBody.firstChild);
    }

    // Limpiar opciones de eliminación de horas
    const deleteHourSelect = document.getElementById('deleteHour');
    deleteHourSelect.innerHTML = '';
}
function populateFields() {
    const selectedCoach = document.getElementById('coach').value;

    if (selectedCoach === "Seleccione un coach") {
        // Si se selecciona "Seleccione un coach", limpiar todos los campos
        clearFields();
    } else if (coachData[selectedCoach]) {
        // Si se selecciona un coach válido, llenar los campos correspondientes
        document.getElementById('portal').value = coachData[selectedCoach].portal;
        document.getElementById('password').value = coachData[selectedCoach].password;
        document.getElementById('zoom').value = coachData[selectedCoach].zoom;
        document.getElementById('zoomPassword').value = coachData[selectedCoach].zoomPassword;

        const emergencyRoomLink = document.getElementById('emergencyRoomLink');
        const emergencyRoomInput = document.getElementById('emergencyRoom');
        const emergencyRoomURL = coachData[selectedCoach].emergencyRoom;

        if (emergencyRoomURL && emergencyRoomURL !== 'No entregada') {
            emergencyRoomLink.href = emergencyRoomURL;
            emergencyRoomLink.style.display = 'block';
            emergencyRoomInput.style.display = 'none';
        } else {
            emergencyRoomInput.value = emergencyRoomURL;
            emergencyRoomInput.style.display = 'block';
            emergencyRoomLink.style.display = 'none';
        }
    } else {
        // Si el coach seleccionado no está en coachData, limpiar los campos también
        clearFields();
    }
}

function clearFields() {
    // Limpiar campos básicos
    document.getElementById('portal').value = '';
    document.getElementById('password').value = '';
    document.getElementById('zoom').value = '';
    document.getElementById('zoomPassword').value = '';
    document.getElementById('emergencyRoom').value = '';
    document.getElementById('emergencyRoomLink').href = '#';
    document.getElementById('emergencyRoomLink').style.display = 'none';
    document.getElementById('emergencyRoom').style.display = 'block';

    // Limpiar campos adicionales
    document.getElementById('date').value = '';
    document.getElementById('coach').value = '';
    document.getElementById('country').value = '';
    document.getElementById('hours').value = '';
    document.getElementById('duracion').value = '';
    document.getElementById('note').value = '';

    // Limpiar las filas de la tabla
    const tableBody = document.getElementById('hoursTable').querySelector('tbody');
    while (tableBody.firstChild) {
        tableBody.removeChild(tableBody.firstChild);
    }

    // Limpiar opciones de eliminación de horas
    const deleteHourSelect = document.getElementById('deleteHour');
    deleteHourSelect.innerHTML = '';
}



function clearHours() {
    const tableBody = document.getElementById('hoursTable').querySelector('tbody');
    while (tableBody.firstChild) {
        tableBody.removeChild(tableBody.firstChild);
    }
    document.getElementById('date').value = '';
    document.getElementById('coach').value = '';
    document.getElementById('country').value = '';
    document.getElementById('hours').value = '';
    document.getElementById('duracion').value = '';
    document.getElementById('note').value = '';

    // Limpiar opciones de eliminación de horas
    const deleteHourSelect = document.getElementById('deleteHour');
    deleteHourSelect.innerHTML = '';
}

        function adjustTime(time, country) {
            const result = {};
            const [hours, minutes] = time.split(':').map(Number);
            const baseTime = new Date();
            baseTime.setUTCHours(hours - timeZones[country], minutes);

            for (const [countryName, offset] of Object.entries(timeZones)) {
                const localTime = new Date(baseTime);
                localTime.setUTCHours(localTime.getUTCHours() + offset);
                const localHours = String(localTime.getUTCHours()).padStart(2, '0');
                const localMinutes = String(localTime.getUTCMinutes()).padStart(2, '0');
                result[countryName] = `${localHours}:${localMinutes}`;
            }

            return result;
        }

        function addHour() {
    const hours = document.getElementById('hours').value;
    const duration = document.getElementById('duracion').value;
    const date = document.getElementById('date').value;
    const coach = document.getElementById('coach').value;
    const country = document.getElementById('country').value;

    if (!hours || !duration || !date || !coach || !country) {
        alert('Por favor, complete todos los campos.');
        return;
    }

    // Obtener la fecha actual en formato YYYY-MM-DD
    const today = new Date().toISOString().split('T')[0];

    const adjustedTimes = adjustTime(hours, country);
    const newRow = document.createElement('tr');

    newRow.innerHTML = `
        <td>${hours}</td>
        <td>${duration} minutos</td>
        <td>
            <select class="coachSelect">
                <option value="No Remplazo">Sin Reemplazo</option>
                <option value="Josue Avila">Josue Avila</option>
                <option value="Magnolia Zuñiga">Magnolia Zuñiga</option>
                <option value="Juan Rodríguez">Juan Rodríguez</option>
                <option value="Daniela Fernandez">Daniela Fernandez</option>
                <option value="Cristian Arriagada">Cristian Arriagada</option>
                <option value="Edwin Juarez">Edwin Juarez</option>
                <option value="Fernanda Ortiz">Fernanda Ortiz</option>
                <option value="Valentina Cornejo">Valentina Cornejo</option>
                <option value="Leandro Rioja">Leandro Rioja</option>
                <option value="Valde Pie">Valde Pie</option>
                <option value="Otro">Otro</option>
            </select>
            <input type="text" class="newCoachName" placeholder="Ingrese nuevo nombre" style="display: none;">
        </td>
        <td>
            <select>
                <option value="Interno">Interno</option>
                <option value="Externo">Externo</option>
            </select>
        </td>
        <td>${adjustedTimes['España']}</td>
        <td>${adjustedTimes['Panamá']}</td>
        <td>${adjustedTimes['EST']}</td>
        <td>${adjustedTimes['República Dominicana']}</td>
        <td>${adjustedTimes['Argentina']}</td>
        <td>${adjustedTimes['Costa Rica']}</td>
        <td>${adjustedTimes['Guatemala']}</td>
        <td>${adjustedTimes['Nicaragua']}</td>
        <td>${adjustedTimes['Chile']}</td>
        <td>${date}</td>
    `;

    // Si la fecha es pasada, marcar la fila en rojo
    if (date < today) {
        newRow.style.backgroundColor = 'red';
        alert('La fecha ingresada es pasada. La fila se ha marcado en rojo. Porfavor elimine esa fila');
    }

    // Agregar la fila a la tabla
    document.getElementById('hoursTable').querySelector('tbody').appendChild(newRow);

    const deleteHourSelect = document.getElementById('deleteHour');
    const newOption = document.createElement('option');
    newOption.value = hours;
    newOption.text = hours;
    deleteHourSelect.appendChild(newOption);
}

async function saveData() {
    const coach = document.getElementById('coach').value;
    const country = document.getElementById('country').value;
    const note = document.getElementById('note').value;

    const rows = document.getElementById('hoursTable').getElementsByTagName('tbody')[0].rows;

    // Recorremos las filas de la tabla para verificar duplicados en Airtable
    for (let row of rows) {
        const coachSolicitante = coach; // Aquí debes tomar el valor seleccionado para Coach Solicitante, no el de Reemplazo
        const fecha = row.cells[13].innerText;
        const horaRD = row.cells[7].innerText; // Hora de República Dominicana

        // Verificar si ya existe un registro con los mismos datos en Airtable
        const filterFormula = `AND({Coach Solicitante}="${coachSolicitante}", {Fecha}="${fecha}", {Hora Republica Dominicana}="${horaRD}")`;

        try {
            const response = await fetch(`${apiUrl}/Independientes?filterByFormula=${encodeURIComponent(filterFormula)}`, {
                method: 'GET',
                headers: {
                    'Authorization': `Bearer ${apiKey}`,
                    'Content-Type': 'application/json'
                }
            });

            if (!response.ok) {
                const errorData = await response.json();
                console.error('Error al verificar los datos:', errorData);
                alert('Error al verificar los datos: ' + JSON.stringify(errorData));
                return; // Detener la función si hay un error en la verificación
            }

            const data = await response.json();

            if (data.records.length > 0) {
                // Si ya existe un registro con la misma combinación de Coach, Fecha y Hora RD
                alert(`Ya existe un registro con el Coach ${coachSolicitante}, la Fecha ${fecha} y la Hora de RD ${horaRD}. No se puede guardar un duplicado.`);
                return; // Detener la función para evitar duplicados
            }

        } catch (error) {
            console.error('Error:', error);
            alert('Error al verificar los datos.');
            return; // Detener la función si hay un error en la verificación
        }
    }

    // Si no hay duplicados, procedemos a construir los registros para guardar
    let records = [];

    for (let row of rows) {
        records.push({
            fields: {
                "Coach Solicitante": coach, // Aquí debe ir el valor correcto de Coach Solicitante
                "País": country,
                "Duración": row.cells[1].innerText,
                "Coach de Reemplazo": row.cells[2].getElementsByTagName('select')[0].value,
                "Tipo de Reemplazo": row.cells[3].getElementsByTagName('select')[0].value,
                "Hora España": row.cells[4].innerText,
                "Hora Panamá": row.cells[5].innerText,
                "Hora EST": row.cells[6].innerText,
                "Hora Republica Dominicana": row.cells[7].innerText,
                "Hora Argentina": row.cells[8].innerText,
                "Hora Costa Rica": row.cells[9].innerText,
                "Hora Guatemala": row.cells[10].innerText,
                "Hora Nicaragua": row.cells[11].innerText,
                "Hora Chile": row.cells[12].innerText,
                "Fecha": row.cells[13].innerText,
                "Nota": note
            }
        });
    }

    console.log(JSON.stringify({ records }));

    try {
        const response = await fetch(`${apiUrl}/Independientes`, {
            method: 'POST',
            headers: {
                'Authorization': `Bearer ${apiKey}`,
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ records })
        });

        if (!response.ok) {
            const errorData = await response.json();
            console.error('Error al guardar los datos:', errorData);
            alert('Error al guardar los datos: ' + JSON.stringify(errorData));
        } else {
            const data = await response.json();
            console.log('Datos guardados con éxito:', data);
            alert('Datos guardados con éxito.');
        }
    } catch (error) {
        console.error('Error:', error);
        alert('Error al guardar los datos.');
    }
}



        const apiUrl = 'https://api.airtable.com/v0/appVuMTXFU8YHrGND';
        const apiKey = 'pat9wBOS3cEULZjbM.46a19c678b7b3a403febb212e0ec73de16f408d4193bf476a5d7348c23be39b1';



        
        async function searchRecords() {
    const coach = document.getElementById('coach').value;

    if (!coach) {
        alert('Por favor, selecciona un Coach.');
        return;
    }

    // Obtener la fecha actual en formato YYYY-MM-DD
    const today = new Date().toISOString().split('T')[0];

    // Fórmula para filtrar por Coach Solicitante y fechas a partir de hoy
    const filterFormula = `AND({Coach Solicitante}="${coach}", IS_AFTER({Fecha}, "${today}"))`;

    try {
        const response = await fetch(`${apiUrl}/Independientes?filterByFormula=${encodeURIComponent(filterFormula)}`, {
            method: 'GET',
            headers: {
                
                'Authorization': `Bearer ${apiKey}`,
                'Content-Type': 'application/json'
            }
            
        });

        if (!response.ok) {
            const errorData = await response.json();
            console.error('Error al buscar los datos:', errorData);
            alert('Error al buscar los datos: ' + JSON.stringify(errorData));
        } else {
            const data = await response.json();
            console.log('Datos recibidos:', data); 

            const tableBody = document.getElementById('hoursTable').getElementsByTagName('tbody')[0];
            tableBody.innerHTML = '';

            if (data.records.length === 0) {
                alert('No se encontraron registros.');
            } else {
                data.records.forEach(record => {
                    const row = tableBody.insertRow();
                    row.setAttribute('data-record-id', record.id);

                    row.insertCell(0).innerText = record.fields["Hora"] || '';
                    row.insertCell(1).innerText = record.fields["Duración"] || '';

                    const coachCell = row.insertCell(2);
                    const coachSelect = document.createElement('select');
                    coachSelect.classList.add('coachSelect');
                    const coaches = [
                        "No Remplazo", "Josue Avila", "Magnolia Zuñiga", "Juan Rodríguez", "Daniela Fernandez",
                        "Cristian Arriagada", "Edwin Juarez", "Fernanda Ortiz", "Valentina Cornejo", "Valde Pie", "Otro"
                    ];
                    coaches.forEach(coachName => {
                        const option = document.createElement('option');
                        option.value = coachName;
                        option.text = coachName;
                        coachSelect.appendChild(option);
                    });
                    coachSelect.value = record.fields["Coach de Reemplazo"] || "No Remplazo";
                    coachCell.appendChild(coachSelect);

                    const newCoachInput = document.createElement('input');
                    newCoachInput.type = 'text';
                    newCoachInput.classList.add('newCoachName');
                    newCoachInput.placeholder = "Ingrese nuevo nombre";
                    newCoachInput.style.display = 'none';
                    coachCell.appendChild(newCoachInput);

                    coachSelect.addEventListener('change', function() {
                        if (coachSelect.value === 'Otro') {
                            newCoachInput.style.display = 'block';
                        } else {
                            newCoachInput.style.display = 'none';
                        }
                    });

                    const tipoReemplazoCell = row.insertCell(3);
                    const tipoReemplazoSelect = document.createElement('select');
                    ["Interno", "Externo"].forEach(tipo => {
                        const option = document.createElement('option');
                        option.value = tipo;
                        option.text = tipo;
                        tipoReemplazoSelect.appendChild(option);
                    });
                    tipoReemplazoSelect.value = record.fields["Tipo de Reemplazo"] || "Interno";
                    tipoReemplazoCell.appendChild(tipoReemplazoSelect);

                    row.insertCell(4).innerText = record.fields["Hora España"] || '';
                    row.insertCell(5).innerText = record.fields["Hora Panamá"] || '';
                    row.insertCell(6).innerText = record.fields["Hora EST"] || '';
                    row.insertCell(7).innerText = record.fields["Hora Republica Dominicana"] || '';
                    row.insertCell(8).innerText = record.fields["Hora Argentina"] || '';
                    row.insertCell(9).innerText = record.fields["Hora Costa Rica"] || '';
                    row.insertCell(10).innerText = record.fields["Hora Guatemala"] || '';
                    row.insertCell(11).innerText = record.fields["Hora Nicaragua"] || '';
                    row.insertCell(12).innerText = record.fields["Hora Chile"] || '';
                    row.insertCell(13).innerText = record.fields["Fecha"] || '';
                });

                if (data.records.length > 0) {
                    document.getElementById('note').value = data.records[data.records.length - 1].fields["Nota"] || '';
                } else {
                    document.getElementById('note').value = '';
                }

                alert('Búsqueda completada con éxito.');
            }
        }
    } catch (error) {
        console.error('Error:', error);
        alert('Error al buscar los datos.');
    }
}

        async function replaceData() {
    const rows = document.getElementById('hoursTable').getElementsByTagName('tbody')[0].rows;
    let records = [];

    for (const row of rows) {
        const recordId = row.getAttribute('data-record-id');
        const coachReemplazo = row.cells[2].getElementsByTagName('select')[0].value;
        const tipoReemplazo = row.cells[3].getElementsByTagName('select')[0].value;

        try {
            // Obtener la fila original de la base de datos
            const response = await fetch(`${apiUrl}/Independientes/${recordId}`, {
                method: 'GET',
                headers: {
                    'Authorization': `Bearer ${apiKey}`,
                    'Content-Type': 'application/json'
                }
            });

            if (!response.ok) {
                console.error('Error al obtener datos:', await response.json());
                alert(`Error al obtener datos para la fila con ID: ${recordId}`);
                continue;
            }

            const data = await response.json();
            const originalCoachReemplazo = data.fields["Coach de Reemplazo"];

            if (originalCoachReemplazo !== "No Remplazo" && coachReemplazo !== "No Remplazo") {
                const password = prompt(`Por favor, ingresa la contraseña o comuniquese con su C.A.                  (Lara Bravo)`);
                if (password !== "CA1.0") {
                    alert(`Contraseña incorrecta, No se le asignara el coach seleccionado`);
                    continue;
                }
            }

            records.push({
                id: recordId,
                fields: {
                    "Coach de Reemplazo": coachReemplazo,
                    "Tipo de Reemplazo": tipoReemplazo
                }
            });

        } catch (error) {
            console.error('Error:', error);
            alert(`Error al procesar la fila `);
        }
    }

    if (records.length === 0) {
        alert('No se encontraron cambios para reemplazar.');
        return;
    }

    for (let i = 0; i < records.length; i += 10) {
        const batch = records.slice(i, i + 10);

        try {
            const response = await fetch(`${apiUrl}/Independientes`, {
                method: 'PATCH',
                headers: {
                    'Authorization': `Bearer ${apiKey}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ records: batch })
            });

            if (!response.ok) {
                const errorData = await response.json();
                console.error('Error al reemplazar los datos:', errorData);
                alert('Error al reemplazar los datos: ' + JSON.stringify(errorData));
            } else {
                const data = await response.json();
                console.log('Datos reemplazados con éxito:', data);
                alert('Datos reemplazados con éxito.');
            }
        } catch (error) {
            console.error('Error:', error);
            alert('Error al reemplazar los datos.');
        }
    }
}



        function showDeleteHourOptions() {
            document.getElementById('deleteOptions').style.display = 'block';
        }

        function removeSelectedHours() {
            const deleteHourSelect = document.getElementById('deleteHour');
            const selectedHour = deleteHourSelect.value;

            if (selectedHour) {
                const rows = document.getElementById('hoursTable').querySelectorAll('tbody tr');
                for (const row of rows) {
                    if (row.cells[0].textContent === selectedHour) {
                        row.remove();
                        break;
                    }
                }

                deleteHourSelect.remove(deleteHourSelect.selectedIndex);
            }
        }

        function clearHours() {
            const table = document.getElementById('hoursTable');
            while (table.rows.length > 1) {
                table.deleteRow(1);
            }
            document.getElementById('date').value = '';
            document.getElementById('coach').value = '';
            document.getElementById('country').value = '';
            document.getElementById('hours').value = '';
            document.getElementById('duracion').value = '';
        }
    </script>
</body>
</html>
