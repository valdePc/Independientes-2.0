<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LM:INDEPENDIENTES 1.0</title>
    <style>
        .logo {
            margin: 0;
            padding: 0;
            text-align: center;
        }

        .logo img {
            display: block;
            margin: 0 auto;
            padding: 0;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px 20px 0 20px; /* Reduce el padding inferior */
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }

        h2 {
            margin-top: 10px; /* Reduce el margen superior del título */
            color: #00a9b5;
        }

        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 20px;
            background: #f4f4f4;
            color: #333;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        .container {
            width: 100%;
            max-width: 100%;
            margin: 0 auto;
            padding: 30px;
            background: white; /* Fondo blanco */
            border-radius: 20px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1), 0 6px 6px rgba(0, 0, 0, 0.1);
            overflow: auto; /* Permitir desplazamiento */
        }

        h2 {
            color: #00a9b5;
            font-size: 2rem;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.2);
            margin-bottom: 20px;
        }

        .form-inline {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
        }

        .form-inline .form-group {
            flex: 1;
            min-width: 200px;
            margin-right: 20px; /* Ajusta el espacio entre los campos */
        }

        #date {
            width: calc(100% - 40px); /* Reduce el ancho del campo de fecha */
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }

        .form-group {
            flex: 1;
            min-width: 200px;
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #00a9b5;
        }

        .form-group select,
        .form-group input {
            width: 100%;
            padding: 12px;
            border: 1px solid #ccc;
            border-radius: 10px;
            box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.1);
            transition: box-shadow 0.3s ease, border-color 0.3s ease;
            background: white; /* Fondo blanco */
        }

        .form-group select:focus,
        .form-group input:focus {
            box-shadow: 0 0 10px rgba(0, 169, 181, 0.5);
            border-color: #00a9b5;
            outline: none;
        }

        .form-group button {
            padding: 12px 20px;
            background: #00a9b5;
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            box-shadow: 0 8px 15px rgba(0, 169, 181, 0.4);
            transition: background 0.3s ease, box-shadow 0.3s ease, transform 0.3s ease;
        }

        .form-group button:hover {
            background: #007b8f;
            box-shadow: 0 12px 25px rgba(0, 169, 181, 0.5);
            transform: translateY(-3px);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 30px;
            background: white; /* Fondo blanco */
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.1);
            min-width: 1200px; /* Asegura que la tabla tenga un ancho mínimo */
        }

        table, th, td {
            border: 1px solid #ddd;
        }

        th, td {
            padding: 15px;
            text-align: center;
            transition: background 0.3s ease;
        }

        th {
            background: #00a9b5;
            color: white;
        }

        th:hover {
            background: #007b8f;
        }

        td:hover {
            background: #f0f8ff;
        }

        .user-info {
            margin-top: 30px;
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
        }

        .user-info .form-group {
            flex: 1;
            min-width: 300px;
        }

        .error {
            color: red;
            display: none;
            font-weight: bold;
        }

        .highlight {
            border-color: red;
        }

        @media (max-width: 768px) {
            .container {
                padding: 20px;
            }

            h2 {
                font-size: 1.5rem;
            }

            .form-group button {
                padding: 10px 20px;
            }
        }

        /* Estilos para el botón Salir */
        #salirBtn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: red;
            color: white;
            border: none;
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            border-radius: 5px;
        }

        #salirBtn:hover {
            background-color: darkred;
        }
         /* Estilo para el botón BDD1.0 */
         .floating-button {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background-color: #4CAF50;
            color: white;
            padding: 15px 25px;
            border: none;
            border-radius: 50px;
            text-align: center;
            font-size: 16px;
            cursor: pointer;
            z-index: 1000;
        }
    </style>
</head>
<body>
    <button id="salirBtn" onclick="window.location.href='index.html';">Salir</button>
    <button class="floating-button" onclick="checkPassword()">BDD/1.0</button>
    <div class="container">
        <div class="container">
            <div class="logo">
                <img src="images/Copia_de_Nuevos_fondos_2023-removebg-preview.png" alt="Logo de Linguameeting">
            </div>
        <h2>Independientes 1.0</h2>
        <div class="form-inline">
            <div class="form-group">
                <label for="date">Fecha:</label>
                <input type="date" id="date">
                <span id="dateError" class="error">Por favor, seleccione una fecha.</span>
            </div>
            <div class="form-group">
                <label for="coach">Coach Solicitante:</label>
                <select id="coach" onchange="populateFields()">
                    <option value="">Seleccione un coach</option>
                    <option value="Lara Bravo">Lara Bravo</option>
                    <option value="Selene Cidoncha">Selene Cidoncha</option>
                    <option value="Eduardo Vaz">Eduardo Vaz</option>
                    <option value="Camila Muñoz">Camila Muñoz</option>
                    <option value="Alejandro Alvarez">Alejandro Alvarez</option>
                    <option value="Miriam Bautista">Miriam Bautista</option>
                    <option value="Karla Guel">Karla Guel</option>
                    <option value="Zachery Sanchez">Zachery Sanchez</option>
                    <option value="Inovis Cortez">Inovis Cortez</option>
                    <option value="Ileana Plata">Ileana Plata</option>
                    <option value="Nelson Guido">Nelson Guido</option>
                    <option value="Sofia Gutierrez">Sofia Gutierrez</option>
                </select>
                <span id="coachError" class="error">Por favor, seleccione un coach.</span>
            </div>
            <div class="form-group">
                <label for="country">País:</label>
                <select id="country">
                    <option value="">Seleccionar país</option>
                    <option value="España">España</option>
                    <option value="Panamá">Panamá</option>
                    <option value="EST">EST</option>
                    <option value="República Dominicana">República Dominicana</option>
                    <option value="Argentina">Argentina</option>
                    <option value="Costa Rica">Costa Rica</option>
                    <option value="Guatemala">Guatemala</option>
                    <option value="Nicaragua">Nicaragua</option>
                    <option value="Chile">Chile</option>
                </select>
                <span id="countryError" class="error">Por favor, seleccione un país.</span>
            </div>
        </div>
        <div class="form-group">
            <label for="hours">Horas:</label>
            <input type="time" id="hours">
            <span id="hoursError" class="error">Por favor, ingrese una hora.</span>
            <button onclick="addHour()">Agregar Hora</button>
            <button onclick="showDeleteHourOptions()">Eliminar Hora</button>
            <button onclick="clearHours()">Limpiar</button>
        </div>
        <div class="form-group" id="deleteOptions" style="display: none;">
            <label for="deleteHour">Seleccionar Hora para Eliminar:</label>
            <select id="deleteHour"></select>
            <button onclick="removeSelectedHours()">Eliminar Selección</button>
        </div>
        <select id="duracion">
            <option value="">Duración</option>
            <option value="15">15 minutos</option>
            <option value="30">30 minutos</option>
            <option value="45">45 minutos</option>
        </select>
        <div class="form-group">
            <label for="note">Nota para el Coach de Reemplazo</label>
            <textarea id="note" rows="4" placeholder="Escribe una nota para el coach de reemplazo aquí..." style="width: 100%;"></textarea>
            
        </div>
        <table id="hoursTable">
            <thead>
                <tr>
                    <th>Hora</th>
                    <th>Duración</th>
                    <th>Coach de Reemplazo</th>
                    <th>Tipo de Reemplazo</th>
                    <th>España</th>
                    <th>Panamá</th>
                    <th>EST</th>
                    <th>República Dominicana</th>
                    <th>Argentina</th>
                    <th>Costa Rica</th>
                    <th>Guatemala</th>
                    <th>Nicaragua</th>
                    <th>Chile</th>
                    <th>Fecha de Reemplazo</th>
                </tr>
            </thead>
            <tbody>
                <!-- Las filas se agregarán dinámicamente -->
            </tbody>
        </table>
        <div class="user-info">
            <div class="form-group">
                <label for="portal">Portal</label>
                <input type="text" id="portal" placeholder="Portal" readonly>
            </div>
            <div class="form-group">
                <label for="password">Contraseña</label>
                <input type="text" id="password" placeholder="Contraseña" readonly>
            </div>
            <div class="form-group">
                <label for="zoom">Zoom</label>
                <input type="text" id="zoom" placeholder="Zoom" readonly>
            </div>
            <div class="form-group">
                <label for="zoomPassword">Contraseña (Zoom)</label>
                <input type="text" id="zoomPassword" placeholder="Contraseña de Zoom" readonly>
            </div>
            <div class="form-group">
                <label for="emergencyRoom">Sala de Emergencia</label>
                <a id="emergencyRoomLink" href="#" target="_blank" style="display:none;">Abrir Sala de Emergencia</a>
                <input type="text" id="emergencyRoom" placeholder="Sala de Emergencia" readonly style="display:none;">
            </div>
        </div>
        <div class="form-group">
            <button onclick="saveData()">Guardar</button>
            <button onclick="searchRecords()">Buscar</button>
            <button onclick="replaceData()">Reemplazar</button>
            
        </div>
    </div>

    <script>
        const timeZones = {
            'España': 2,
            'Panamá': -5,
            'EST': -4,
            'República Dominicana': -4,
            'Argentina': -3,
            'Costa Rica': -6,
            'Guatemala': -6,
            'Nicaragua': -6,
            'Chile': -4
        };
        const coachData = {
            'Lara Bravo': { emergencyRoom: 'https://linguameeting.zoom.us/j/91058372053?pwd=ZWl2bzJTZ0FndGhCNk1FWVc2UGhRUT09' },
            'Selene Cidoncha': { emergencyRoom: 'https://linguameeting.zoom.us/j/91058372053?pwd=ZWl2bzJTZ0FndGhCNk1FWVc2UGhRUT09' },
            'Eduardo Vaz': { emergencyRoom: 'https://linguameeting.zoom.us/j/94390800576?pwd=WVZXcklDVHB6NFlma1RxdHMvcnlvZz09' },
            'Camila Muñoz': { emergencyRoom: 'https://linguameeting.zoom.us/j/96784838803?pwd=Tyt5RFNidFA2MjdWSFd0bGtxaDJ6dz09' },
            'Alejandro Alverez': { emergencyRoom: 'https://linguameeting.zoom.us/j/99032698699?pwd=TdJeJBJNu20PznWPRj8Fo5amyaTxYB.1' },
            'Miriam Bautista': { emergencyRoom: 'https://linguameeting.zoom.us/j/98512648322?pwd=dms4VGd4V2FCL0ZkWSt6MUUwZ29vdz09' },
            'Karla Guel': { emergencyRoom: 'https://linguameeting.zoom.us/j/95638745486?pwd=ayIYgKyXMarDZFBIPUGp8xO0qS7ea0.1' },
            'Zachery Sanchez': { emergencyRoom: 'https://linguameeting.zoom.us/j/98815343064?pwd=z0TU1oKoqtIVYbDs1bymsOWGRdOi4t.1' },
            'Imnovis Cortez': { emergencyRoom: 'https://linguameeting.zoom.us/j/6882524640?pwd=BPb4TN8diEMo4AcPkUcphZKMErV9yE.1' },
            'Ileana Plata': { emergencyRoom: 'https://linguameeting.zoom.us/j/6882524640?pwd=BPb4TN8diEMo4AcPkUcphZKMErV9yE.1' },
            'Nelson Guido': { emergencyRoom: 'https://linguameeting.zoom.us/j/6882524640?pwd=BPb4TN8diEMo4AcPkUcphZKMErV9yE.1' },
            'Sofia Gutierrez': { emergencyRoom: 'https://linguameeting.zoom.us/j/6882524640?pwd=BPb4TN8diEMo4AcPkUcphZKMErV9yE.1' }
        };
        
        function clearFields() {
    // Limpiar campos básicos
    document.getElementById('emergencyRoom').value = '';
    document.getElementById('emergencyRoomLink').href = '#'; // Restablecer el enlace de la sala de emergencia
    document.getElementById('emergencyRoomLink').style.display = 'none'; // Ocultar el enlace de la sala de emergencia
    document.getElementById('emergencyRoom').style.display = 'block'; // Mostrar el campo de texto de la sala de emergencia en blanco

    // Limpiar campos adicionales
    document.getElementById('date').value = '';
    document.getElementById('coach').value = '';
    document.getElementById('country').value = '';
    document.getElementById('hours').value = '';
    document.getElementById('duracion').value = '';
    document.getElementById('note').value = '';
 
    // Limpiar las filas de la tabla
    const tableBody = document.getElementById('hoursTable').querySelector('tbody');
    while (tableBody.firstChild) {
        tableBody.removeChild(tableBody.firstChild);
    }

    // Limpiar opciones de eliminación de horas
    const deleteHourSelect = document.getElementById('deleteHour');
    deleteHourSelect.innerHTML = '';
}

function populateFields() {
    const selectedCoach = document.getElementById('coach').value;

    if (selectedCoach === "") {
        // Llamar a la función clearFields para limpiar todos los campos
        clearFields();
    } else if (coachData[selectedCoach]) {
        // Rellenar los campos con los datos del coach seleccionado
       
        const emergencyRoomLink = document.getElementById('emergencyRoomLink');
        const emergencyRoomInput = document.getElementById('emergencyRoom');
        const emergencyRoomURL = coachData[selectedCoach].emergencyRoom;

        if (emergencyRoomURL && emergencyRoomURL !== 'No entregada') {
            emergencyRoomLink.href = emergencyRoomURL;
            emergencyRoomLink.style.display = 'block';
            emergencyRoomInput.style.display = 'none';
        } else {
            emergencyRoomInput.value = emergencyRoomURL;
            emergencyRoomInput.style.display = 'block';
            emergencyRoomLink.style.display = 'none';
        }
    }
}

function clearHours() {
    const tableBody = document.getElementById('hoursTable').querySelector('tbody');
    while (tableBody.firstChild) {
        tableBody.removeChild(tableBody.firstChild);
    }
    document.getElementById('date').value = '';
    document.getElementById('coach').value = '';
    document.getElementById('country').value = '';
    document.getElementById('hours').value = '';
    document.getElementById('duracion').value = '';
    document.getElementById('note').value = '';

    // Limpiar opciones de eliminación de horas
    const deleteHourSelect = document.getElementById('deleteHour');
    deleteHourSelect.innerHTML = '';

}


        function adjustTime(time, country) {
            const result = {};
            const [hours, minutes] = time.split(':').map(Number);
            const baseTime = new Date();
            baseTime.setUTCHours(hours - timeZones[country], minutes);

            for (const [countryName, offset] of Object.entries(timeZones)) {
                const localTime = new Date(baseTime);
                localTime.setUTCHours(localTime.getUTCHours() + offset);
                const localHours = String(localTime.getUTCHours()).padStart(2, '0');
                const localMinutes = String(localTime.getUTCMinutes()).padStart(2, '0');
                result[countryName] = `${localHours}:${localMinutes}`;
            }

            return result;
        }
        let existingEntries = []; // Array to store existing entries

async function addHour() {
    const hours = document.getElementById('hours').value;
    const duration = document.getElementById('duracion').value;
    const date = document.getElementById('date').value;
    const coach = document.getElementById('coach').value;
    const country = document.getElementById('country').value;

    if (!hours || !duration || !date || !coach || !country) {
        alert('Por favor, complete todos los campos.');
        return;
    }

    // Verificación local para evitar duplicados en la sesión actual
    const duplicate = existingEntries.find(entry =>
        entry.coach === coach &&
        entry.fecha === date &&
        entry.horaRD === hours
    );

    if (duplicate) {
        alert('Ya existe un registro con los mismos datos en la tabla.');
        return; // Detener la función si se encuentra un duplicado en la sesión actual
    }

    // Verificar si la hora ya existe en Airtable
    const filterFormula = `AND({Coach Solicitante}="${coach}", {Fecha}="${date}", {Hora Republica Dominicana}="${hours}")`;

    try {
        const response = await fetch(`${apiUrl}/Independientes 1.0?filterByFormula=${encodeURIComponent(filterFormula)}`, {
            method: 'GET',
            headers: {
                'Authorization': `Bearer ${apiKey}`,
                'Content-Type': 'application/json'
            }
        });

        if (!response.ok) {
            const errorData = await response.json();
            console.error('Error al verificar los datos en Airtable:', errorData);
            alert('Error al verificar los datos en Airtable: ' + JSON.stringify(errorData));
            return;
        }

        const data = await response.json();

        if (data.records.length > 0) {
            alert('Ya existe un registro en Airtable con el mismo Coach, Fecha y Hora de RD. No se puede agregar esta fila.');
            return; // Detener la función si ya existe un registro en Airtable
        }

    } catch (error) {
        console.error('Error al verificar los datos en Airtable:', error);
        alert('Error al verificar los datos en Airtable.');
        return;
    }

    // Si no hay duplicados, proceder a agregar la fila
    const adjustedTimes = adjustTime(hours, country);
    const newRow = document.createElement('tr');

    newRow.innerHTML = `
        <td>${hours}</td>
        <td>${duration} minutos</td>
        <td>
            <select class="coachSelect">
                        <option value="No Remplazo">Sin Reemplazo</option>
                        <option value="Lara Bravo">Lara Bravo</option>
                        <option value="Selene Cidoncha">Selene Cidoncha</option>
                        <option value="Eduardo Vaz">Eduardo Vaz</option>
                        <option value="Camila Muñoz">Camila Muñoz</option>
                        <option value="Alejandro Alvarez">Alejandro Alvarez</option>
                        <option value="Miriam Bautista">Miriam Bautista</option>
                        <option value="Karla Guel">Karla Guel</option>
                        <option value="Zachery Sanchez">Zachery Sanchez</option>
                        <option value="Imnovis Corte">Imnovis Cortez</option>
                        <option value="Ileana Plata">Ileana Plata</option>
                        <option value="Nelson Guido">Nelson Guido</option>
                        <option value="Sofia Gutierrez">Sofia Gutierrez</option>
                        <option value="Otro">Otro</option>
                    </select>
            <input type="text" class="newCoachName" placeholder="Ingrese nuevo nombre" style="display: none;">
        </td>
        <td>
            <select>
                <option value="Interno">Interno</option>
                <option value="Externo">Externo</option>
            </select>
        </td>
        <td>${adjustedTimes['España']}</td>
        <td>${adjustedTimes['Panamá']}</td>
        <td>${adjustedTimes['EST']}</td>
        <td>${adjustedTimes['República Dominicana']}</td>
        <td>${adjustedTimes['Argentina']}</td>
        <td>${adjustedTimes['Costa Rica']}</td>
        <td>${adjustedTimes['Guatemala']}</td>
        <td>${adjustedTimes['Nicaragua']}</td>
        <td>${adjustedTimes['Chile']}</td>
        <td>${date}</td>
    `;

    // Si la fecha es pasada, marcar la fila en rojo
    const today = new Date().toISOString().split('T')[0];
    if (date < today) {
        newRow.style.backgroundColor = 'red';
        alert('La fecha ingresada es pasada. La fila se ha marcado en rojo. Por favor, elimine esa fila.');
    }

    // Agregar la fila a la tabla
    document.getElementById('hoursTable').querySelector('tbody').appendChild(newRow);

    const deleteHourSelect = document.getElementById('deleteHour');
    const newOption = document.createElement('option');
    newOption.value = hours;
    newOption.text = hours;
    deleteHourSelect.appendChild(newOption);

    // Agregar el nuevo registro a la lista local para evitar duplicados en la misma sesión
    existingEntries.push({ coach, fecha: date, horaRD: hours });
}

async function saveData() {
    const coach = document.getElementById('coach').value;
    const country = document.getElementById('country').value;
    const note = document.getElementById('note').value;

    const rows = document.getElementById('hoursTable').getElementsByTagName('tbody')[0].rows;

    // Verificar duplicados en Airtable para todas las filas de la tabla
    for (let row of rows) {
        const coachSolicitante = coach;
        const fecha = row.cells[13].innerText;
        const horaRD = row.cells[7].innerText;

        // Verificar duplicados en Airtable
        const filterFormula = `AND({Coach Solicitante}="${coachSolicitante}", {Fecha}="${fecha}", {Hora Republica Dominicana}="${horaRD}")`;

        try {
            const response = await fetch(`${apiUrl}/Independientes 1.0?filterByFormula=${encodeURIComponent(filterFormula)}`, {
                method: 'GET',
                headers: {
                    'Authorization': `Bearer ${apiKey}`,
                    'Content-Type': 'application/json'
                }
            });

            if (!response.ok) {
                const errorData = await response.json();
                console.error('Error al verificar los datos en Airtable:', errorData);
                alert('Error al verificar los datos en Airtable: ' + JSON.stringify(errorData));
                return;
            }

            const data = await response.json();

            if (data.records.length > 0) {
                // Si ya existe un registro con la misma combinación en Airtable
                alert(`Ya existe un registro en Airtable con el Coach ${coachSolicitante}, la Fecha ${fecha} y la Hora de RD ${horaRD}. No se puede guardar un duplicado.`);
                return; // Detener la función para evitar guardar duplicados
            }

        } catch (error) {
            console.error('Error al verificar los datos en Airtable:', error);
            alert('Error al verificar los datos en Airtable.');
            return;
        }
    }

    // Si no hay duplicados en Airtable, procedemos a construir los registros para guardar
    let records = [];

    for (let row of rows) {
        records.push({
            fields: {
                "Coach Solicitante": coach,
                "País": country,
                "Duración": row.cells[1].innerText,
                "Coach de Reemplazo": row.cells[2].getElementsByTagName('select')[0].value,
                "Tipo de Reemplazo": row.cells[3].getElementsByTagName('select')[0].value,
                "Hora España": row.cells[4].innerText,
                "Hora Panamá": row.cells[5].innerText,
                "Hora EST": row.cells[6].innerText,
                "Hora Republica Dominicana": row.cells[7].innerText,
                "Hora Argentina": row.cells[8].innerText,
                "Hora Costa Rica": row.cells[9].innerText,
                "Hora Guatemala": row.cells[10].innerText,
                "Hora Nicaragua": row.cells[11].innerText,
                "Hora Chile": row.cells[12].innerText,
                "Fecha": row.cells[13].innerText,
                "Nota": note
            }
        });
    }

    console.log(JSON.stringify({ records }));

    try {
        const response = await fetch(`${apiUrl}/Independientes 1.0`, {
            method: 'POST',
            headers: {
                'Authorization': `Bearer ${apiKey}`,
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ records })
        });

        if (!response.ok) {
            const errorData = await response.json();
            console.error('Error al guardar los datos:', errorData);
            alert('Error al guardar los datos: ' + JSON.stringify(errorData));
        } else {
            const data = await response.json();
            console.log('Datos guardados con éxito:', data);
            alert('Datos guardados con éxito.');

            // Limpiar los campos y la tabla después de guardar
            clearForm();
        }
    } catch (error) {
        console.error('Error al guardar los datos:', error);
        alert('Error al guardar los datos.');
    }
}

function clearForm() {
    // Limpiar los campos del formulario
    document.getElementById('coach').value = '';
    document.getElementById('country').value = '';
    document.getElementById('note').value = '';
    document.getElementById('hours').value = '';
    document.getElementById('duracion').value = '';
    document.getElementById('date').value = '';

    // Limpiar la tabla
    const tableBody = document.getElementById('hoursTable').getElementsByTagName('tbody')[0];
    while (tableBody.firstChild) {
        tableBody.removeChild(tableBody.firstChild);
    }

    // Limpiar el selector de horas para eliminar
    const deleteHourSelect = document.getElementById('deleteHour');
    deleteHourSelect.innerHTML = ''; // Elimina todas las opciones
}



        const apiUrl = 'https://api.airtable.com/v0/appx4eD3f7NINswZW';
        const apiKey = 'patsEfxSCLWnTojGq.2f2358fbbfcbe9c18188eb01cfc52830bea349c615046e58fe80443b5a4109cb';



        
        async function searchRecords() {
    const coach = document.getElementById('coach').value;

    if (!coach) {
        alert('Por favor, selecciona un Coach.');
        return;
    }

    // Fórmula para filtrar solo por Coach Solicitante
    const filterFormula = `{Coach Solicitante}="${coach}"`;

    // Mostrar los valores en consola para depuración
    console.log('Coach:', coach);
    console.log('Filter Formula:', filterFormula);

    try {
        const response = await fetch(`${apiUrl}/Independientes 1.0?filterByFormula=${encodeURIComponent(filterFormula)}`, {
            method: 'GET',
            headers: {
                'Authorization': `Bearer ${apiKey}`,
                'Content-Type': 'application/json'
            }
        });

        if (!response.ok) {
            const errorData = await response.json();
            console.error('Error al buscar los datos:', errorData);
            alert('Error al buscar los datos: ' + JSON.stringify(errorData));
        } else {
            const data = await response.json();
            console.log('Datos recibidos:', data);

            const tableBody = document.getElementById('hoursTable').getElementsByTagName('tbody')[0];
            tableBody.innerHTML = '';

            if (data.records.length === 0) {
                alert('No se encontraron registros.');
            } else {
                data.records.forEach(record => {
                    const row = tableBody.insertRow();
                    row.setAttribute('data-record-id', record.id);

                    row.insertCell(0).innerText = record.fields["Hora"] || '';
                    row.insertCell(1).innerText = record.fields["Duración"] || '';

                    const coachCell = row.insertCell(2);
                    const coachSelect = document.createElement('select');
                    coachSelect.classList.add('coachSelect');
                    const coaches = [
                        "No Remplazo", "Lara Bravo", "Selene Cidoncha", "Eduardo Vaz", "Camila Muñoz",
                        "Alejandro Alverez", "Miriam Bautista", "Karla Guel", "Zachery Sanchez", "Imnovis Cortez","Imnovis Cortez","Ileana Plata","Nelson Guido","Sofia Gutierrez",  "Otro"
                    ];
                    coaches.forEach(coachName => {
                        const option = document.createElement('option');
                        option.value = coachName;
                        option.text = coachName;
                        coachSelect.appendChild(option);
                    });
                    coachSelect.value = record.fields["Coach de Reemplazo"] || "No Remplazo";
                    coachCell.appendChild(coachSelect);

                    const newCoachInput = document.createElement('input');
                    newCoachInput.type = 'text';
                    newCoachInput.classList.add('newCoachName');
                    newCoachInput.placeholder = "Ingrese nuevo nombre";
                    newCoachInput.style.display = 'none';
                    coachCell.appendChild(newCoachInput);

                    coachSelect.addEventListener('change', function() {
                        if (coachSelect.value === 'Otro') {
                            newCoachInput.style.display = 'block';
                        } else {
                            newCoachInput.style.display = 'none';
                        }
                    });

                    const tipoReemplazoCell = row.insertCell(3);
                    const tipoReemplazoSelect = document.createElement('select');
                    ["Interno", "Externo"].forEach(tipo => {
                        const option = document.createElement('option');
                        option.value = tipo;
                        option.text = tipo;
                        tipoReemplazoSelect.appendChild(option);
                    });
                    tipoReemplazoSelect.value = record.fields["Tipo de Reemplazo"] || "Interno";
                    tipoReemplazoCell.appendChild(tipoReemplazoSelect);

                    row.insertCell(4).innerText = record.fields["Hora España"] || '';
                    row.insertCell(5).innerText = record.fields["Hora Panamá"] || '';
                    row.insertCell(6).innerText = record.fields["Hora EST"] || '';
                    row.insertCell(7).innerText = record.fields["Hora Republica Dominicana"] || '';
                    row.insertCell(8).innerText = record.fields["Hora Argentina"] || '';
                    row.insertCell(9).innerText = record.fields["Hora Costa Rica"] || '';
                    row.insertCell(10).innerText = record.fields["Hora Guatemala"] || '';
                    row.insertCell(11).innerText = record.fields["Hora Nicaragua"] || '';
                    row.insertCell(12).innerText = record.fields["Hora Chile"] || '';
                    row.insertCell(13).innerText = record.fields["Fecha"] || '';
                });

                if (data.records.length > 0) {
                    document.getElementById('note').value = data.records[data.records.length - 1].fields["Nota"] || '';
                } else {
                    document.getElementById('note').value = '';
                }

                alert('Búsqueda completada con éxito.');
            }
        }
    } catch (error) {
        console.error('Error:', error);
        alert('Error al buscar los datos.');
    }
}


async function replaceData() {
    const rows = document.getElementById('hoursTable').getElementsByTagName('tbody')[0].rows;
    let records = [];

    for (const row of rows) {
        const recordId = row.getAttribute('data-record-id');
        let coachReemplazo = row.cells[2].getElementsByTagName('select')[0].value;
        const tipoReemplazo = row.cells[3].getElementsByTagName('select')[0].value;

        // Verificar si se seleccionó "Otro" y obtener el valor del campo de texto
        if (coachReemplazo === "Otro") {
            const newCoachNameInput = row.cells[2].getElementsByClassName('newCoachName')[0];
            if (newCoachNameInput && newCoachNameInput.value.trim() !== '') {
                coachReemplazo = newCoachNameInput.value.trim();
            } else {
                alert('Por favor, ingresa un nombre en el campo "Otro".');
                continue; // Saltar esta fila si no se ingresa un nombre
            }
        }

        try {
            // Obtener la fila original de la base de datos
            const response = await fetch(`${apiUrl}/Independientes 1.0/${recordId}`, {
                method: 'GET',
                headers: {
                    'Authorization': `Bearer ${apiKey}`,
                    'Content-Type': 'application/json'
                }
            });

            if (!response.ok) {
                console.error('Error al obtener datos:', await response.json());
                alert(`Error al obtener datos para la fila con ID: ${recordId}`);
                continue;
            }

            const data = await response.json();
            const originalCoachReemplazo = data.fields["Coach de Reemplazo"];

            if (originalCoachReemplazo !== "No Remplazo" && coachReemplazo !== "No Remplazo") {
                const password = prompt(`Por favor, ingresa la contraseña o comuníquese con su C.A. (Lara Bravo)`);
                if (password !== "CA1.0") {
                    alert(`Contraseña incorrecta, No se le asignará el coach seleccionado`);
                    continue;
                }
            }

            records.push({
                id: recordId,
                fields: {
                    "Coach de Reemplazo": coachReemplazo,
                    "Tipo de Reemplazo": tipoReemplazo
                }
            });

        } catch (error) {
            console.error('Error:', error);
            alert(`Error al procesar la fila `);
        }
    }

    if (records.length === 0) {
        alert('No se encontraron cambios para reemplazar.');
        return;
    }

    for (let i = 0; i < records.length; i += 10) {
        const batch = records.slice(i, i + 10);

        try {
            const response = await fetch(`${apiUrl}/Independientes 1.0`, {
                method: 'PATCH',
                headers: {
                    'Authorization': `Bearer ${apiKey}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ records: batch })
            });

            if (!response.ok) {
                const errorData = await response.json();
                console.error('Error al reemplazar los datos:', errorData);
                alert('Error al reemplazar los datos: ' + JSON.stringify(errorData));
            } else {
                const data = await response.json();
                console.log('Datos reemplazados con éxito:', data);
                alert('Datos reemplazados con éxito.');
            }
        } catch (error) {
            console.error('Error:', error);
            alert('Error al reemplazar los datos.');
        }
    }
}


        function showDeleteHourOptions() {
            document.getElementById('deleteOptions').style.display = 'block';
        }

        function removeSelectedHours() {
            const deleteHourSelect = document.getElementById('deleteHour');
            const selectedHour = deleteHourSelect.value;

            if (selectedHour) {
                const rows = document.getElementById('hoursTable').querySelectorAll('tbody tr');
                for (const row of rows) {
                    if (row.cells[0].textContent === selectedHour) {
                        row.remove();
                        break;
                    }
                }

                deleteHourSelect.remove(deleteHourSelect.selectedIndex);
            }
        }

        function clearHours() {
            const table = document.getElementById('hoursTable');
            while (table.rows.length > 1) {
                table.deleteRow(1);
            }
            document.getElementById('date').value = '';
            document.getElementById('coach').value = '';
            document.getElementById('country').value = '';
            document.getElementById('hours').value = '';
            document.getElementById('duracion').value = '';
        }
        function checkPassword() {
            const password = prompt("Por favor, ingrese la contraseña:");

            if (password === "CA1.0") {
                window.location.href = "https://airtable.com/invite/l?inviteId=invKBDwC0WEBChOj2&inviteToken=2dc5bcb71bdc508b2790862b607e2d994b26330f3c385413a008a973113d6b55&utm_medium=email&utm_source=product_team&utm_content=transactional-alerts";
            } else {
                alert("Contraseña incorrecta.");
            }
        }
    </script>
</body>
</html>
