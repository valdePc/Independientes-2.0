<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LM:INDEPENDIENTES0.2</title>
    <link rel="icon" href="data:," />

    <style>
        .logo {
            margin: 0;
            padding: 0;
            text-align: center;
        }

        .logo img {
            display: block;
            margin: 0 auto;
            padding: 0;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px 20px 0 20px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }

        h2 {
            margin-top: 10px;
            color: #00a9b5;
        }

        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 20px;
            background: #f4f4f4;
            color: #333;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        .container {
            width: 100%;
            max-width: 100%;
            margin: 0 auto;
            padding: 30px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1), 0 6px 6px rgba(0, 0, 0, 0.1);
            overflow: auto;
        }

        h2 {
            color: #00a9b5;
            font-size: 2rem;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.2);
            margin-bottom: 20px;
        }

        .form-inline {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
        }

        .form-inline .form-group {
            flex: 1;
            min-width: 200px;
            margin-right: 20px;
        }

        #date {
            width: calc(100% - 40px);
            padding: 10px;
            border: 1px solid black;
            border-radius: 5px;
        }

        .form-group {
            flex: 1;
            min-width: 200px;
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #00a9b5;
        }

        .form-group select,
        .form-group input {
            width: 100%;
            padding: 12px;
            border: 1px solid black;
            border-radius: 10px;
            box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.1);
            transition: box-shadow 0.3s ease, border-color 0.3s ease;
            background: white;
        }

        .form-group select:focus,
        .form-group input:focus {
            box-shadow: 0 0 10px rgba(0, 169, 181, 0.5);
            border-color: #00a9b5;
            outline: none;
        }

        .form-group button {
            padding: 12px 20px;
            background: #00a9b5;
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            box-shadow: 0 8px 15px rgba(0, 169, 181, 0.4);
            transition: background 0.3s ease, box-shadow 0.3s ease, transform 0.3s ease;
        }

        .form-group button:hover {
            background: #007b8f;
            box-shadow: 0 12px 25px rgba(0, 169, 181, 0.5);
            transform: translateY(-3px);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 30px;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.1);
            min-width: 1200px;
        }

        table, th, td {
            border: 1px solid black;
        }

        th, td {
            padding: 15px;
            text-align: center;
            transition: background 0.3s ease;
        }

        th {
            background: #00a9b5;
            color: black;
        }

        th:hover {
            background: #007b8f;
        }

        td:hover {
            background: white;
        }

        .user-info {
            margin-top: 30px;
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
        }

        .user-info .form-group {
            flex: 1;
            min-width: 300px;
        }

        .error {
            color: red;
            display: none;
            font-weight: bold;
        }

        .highlight {
            border-color: red;
        }

        @media (max-width: 768px) {
            .container {
                padding: 20px;
            }

            h2 {
                font-size: 1.5rem;
            }

            .form-group button {
                padding: 10px 20px;
            }
        }

        /* Estilos para el botón Salir */
        #salirBtn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: red;
            color: white;
            border: none;
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            border-radius: 5px;
        }

        #salirBtn:hover {
            background-color: darkred;
        }
        /* Estilo para el botón BDD2.0 */
        .floating-button {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background-color: #4CAF50;
            color: white;
            padding: 15px 20px;
            border: none;
            border-radius: 5px;
            text-align: center;
            font-size: 16px;
            cursor: pointer;
            z-index: 1000;
        }
    </style>
</head>
<body>
    <button id="salirBtn" onclick="window.location.href='index.html';">Salir</button>
    <button class="floating-button" onclick="checkPassword()">BDD/2.0</button>

    <div class="container">
        <div class="container">
            <div class="logo">
                <img src="images/Copia_de_Nuevos_fondos_2023-removebg-preview.png" alt="Logo de Linguameeting">
            </div>
        <h2>Reemplazos</h2>
        <div class="form-inline">
            <div class="form-group">
                <label for="date">Fecha:</label>
                <input type="date" id="date">
                <span id="dateError" class="error">Por favor, seleccione una fecha.</span>
            </div>
            <div class="form-group">
                <label for="coach">Coach Solicitante:</label>
                <select id="coach" onchange="populateFields()">
                    <option value="">Seleccione un coach</option>
                </select>
                
                <span id="coachError" class="error">Por favor, seleccione un coach.</span>
            </div>
            <div class="form-group">
                <label for="country">País:</label>
                <select id="country">
                    <option value="">Seleccionar país</option>
                    <option value="España">España</option>
                    <option value="Panamá">Panamá</option>
                    <option value="EST">EST</option>
                    <option value="República Dominicana">República Dominicana</option>
                    <option value="Argentina">Argentina</option>
                    <option value="Costa Rica">Costa Rica</option>
                    <option value="Guatemala">Guatemala</option>
                    <option value="Nicaragua">Nicaragua</option>
                    <option value="Chile">Chile</option>
                </select>
                <span id="countryError" class="error">Por favor, seleccione un país.</span>
            </div>
        </div>
        <div class="form-group">
            <label for="hours">Horas:</label>
            <input type="time" id="hours">
            <span id="hoursError" class="error">Por favor, ingrese una hora.</span>
            <button onclick="addHour()">Agregar Hora</button>
            <button onclick="showDeleteHourOptions()">Eliminar Hora</button>
            <button onclick="clearHours()">Limpiar</button>
        </div>
        <div class="form-group" id="deleteOptions" style="display: none;">
            <label for="deleteHour">Seleccionar Hora para Eliminar:</label>
            <select id="deleteHour"></select>
            <button onclick="removeSelectedHours()">Eliminar Selección</button>
        </div>
        <select id="duracion">
            <option value="">Duración</option>
            <option value="15">15 minutos</option>
            <option value="30">30 minutos</option>
            <option value="45">45 minutos</option>
        </select>
        <div class="form-group">
            <label for="note">Nota para el Coach de Reemplazo</label>
            <textarea id="note" rows="4" placeholder="Escribe una nota para el coach de reemplazo aquí..." style="width: 100%;"></textarea>
        </div>
        <table id="hoursTable">
            <thead>
                <tr>
                    <th>Hora</th>
                    <th>Duración</th>
                    <th>Coach de Reemplazo</th>
                    <th>Tipo de Reemplazo</th>
                    <th>España</th>
                    <th>Panamá</th>
                    <th>EST</th>
                    <th>República Dominicana</th>
                    <th>Argentina</th>
                    <th>Costa Rica</th>
                    <th>Guatemala</th>
                    <th>Nicaragua</th>
                    <th>Chile</th>
                    <th>Fecha de Reemplazo</th>
                </tr>
            </thead>
            <tbody>
                <!-- Las filas se agregarán dinámicamente -->
            </tbody>
        </table>
        <div class="user-info">
            <div class="form-group">
                <label for="portal">Portal</label>
                <input type="text" id="portal" placeholder="Portal" readonly>
            </div>
            <div class="form-group">
                <label for="password">Contraseña</label>
                <input type="text" id="password" placeholder="Contraseña" readonly>
            </div>
            <div class="form-group">
                <label for="zoom">Zoom</label>
                <input type="text" id="zoom" placeholder="Zoom" readonly>
            </div>
            <div class="form-group">
                <label for="zoomPassword">Contraseña (Zoom)</label>
                <input type="text" id="zoomPassword" placeholder="Contraseña de Zoom" readonly>
            </div>
            <div class="form-group">
                <label for="emergencyRoom">Sala de Emergencia</label>
                <a id="emergencyRoomLink" href="#" target="_blank" style="display:none;">Abrir Sala de Emergencia</a>
                <input type="text" id="emergencyRoom" placeholder="Sala de Emergencia" readonly style="display:none;">
            </div>
        </div>
        <div class="form-group">
            <button onclick="saveData()">Guardar</button>
            <button onclick="searchRecords()">Buscar</button>
            <button onclick="replaceData()">Reemplazar</button>
        </div>
    </div>

    <script>
        // Función para obtener el valor del parámetro 'grupo' de la URL
function getQueryParam(param) {
    const urlParams = new URLSearchParams(window.location.search);
    return urlParams.get(param);
}
// URL de la API y clave

// Obtener el valor del parámetro 'grupo' de la URL
function getQueryParam(param) {
    const urlParams = new URLSearchParams(window.location.search);
    return urlParams.get(param);
}

// Cargar coaches por grupo
async function loadCoachesByGroup() {
    const group = getQueryParam('grupo'); // Obtén el grupo desde la URL

    if (!group) {
        alert('Grupo no especificado. Por favor, selecciona un grupo en la página principal.');
        return;
    }

    try {
        // Haz la solicitud al servidor proxy
        const response = await fetch(`http://localhost:3000/airtable?group=${group}`);
        
        if (!response.ok) {
            throw new Error('Error en la respuesta del servidor');
        }

        const data = await response.json(); // Datos obtenidos desde el proxy
        console.log('Datos cargados:', data);

        if (!data.records || data.records.length === 0) {
            alert(`No se encontraron coaches para el grupo "${group}".`);
            return;
        }

        const coachSelect = document.getElementById('coach');
        coachSelect.innerHTML = '<option value="">Seleccione un coach</option>'; // Limpia las opciones existentes

        // Rellena las opciones del select con los coaches
        data.records.forEach(record => {
            const coachName = record.fields['Coach Solicitante'];
            if (coachName) {
                const option = document.createElement('option');
                option.value = coachName;
                option.textContent = coachName;
                coachSelect.appendChild(option);
            }
        });

        alert('Lista de coaches cargada con éxito.');
    } catch (error) {
        console.error('Error al cargar los coaches:', error);
        alert('No se pudieron cargar los coaches. Intente de nuevo más tarde.');
    }
}


// Llamar a la función cuando la página se cargue
document.addEventListener('DOMContentLoaded', loadCoachesByGroup);


        function clearFields() {
            document.getElementById('zoom').value = '';
            document.getElementById('zoomPassword').value = '';
            document.getElementById('emergencyRoom').value = '';
            document.getElementById('emergencyRoomLink').href = '#';
            document.getElementById('emergencyRoomLink').style.display = 'none';
            document.getElementById('emergencyRoom').style.display = 'block';

            document.getElementById('date').value = '';
            document.getElementById('coach').value = '';
            document.getElementById('country').value = '';
            document.getElementById('hours').value = '';
            document.getElementById('duracion').value = '';
            document.getElementById('note').value = '';

            document.getElementById('portal').value = ''; 
            document.getElementById('password').value = ''; 
            document.getElementById('zoom').value = ''; 
            document.getElementById('zoomPassword').value = ''; 

            const tableBody = document.getElementById('hoursTable').querySelector('tbody');
            while (tableBody.firstChild) {
                tableBody.removeChild(tableBody.firstChild);
            }

            const deleteHourSelect = document.getElementById('deleteHour');
            deleteHourSelect.innerHTML = '';
        }

        function populateFields() {
            const selectedCoach = document.getElementById('coach').value;

            if (selectedCoach === "") {
                clearFields();
            } else if (coachData[selectedCoach]) {
                document.getElementById('portal').value = coachData[selectedCoach].portal;
                document.getElementById('password').value = coachData[selectedCoach].password;
                document.getElementById('zoom').value = coachData[selectedCoach].zoom;
                document.getElementById('zoomPassword').value = coachData[selectedCoach].zoomPassword;

                const emergencyRoomLink = document.getElementById('emergencyRoomLink');
                const emergencyRoomInput = document.getElementById('emergencyRoom');
                const emergencyRoomURL = coachData[selectedCoach].emergencyRoom;

                if (emergencyRoomURL && emergencyRoomURL !== 'No entregada') {
                    emergencyRoomLink.href = emergencyRoomURL;
                    emergencyRoomLink.style.display = 'block';
                    emergencyRoomInput.style.display = 'none';
                } else {
                    emergencyRoomInput.value = emergencyRoomURL;
                    emergencyRoomInput.style.display = 'block';
                    emergencyRoomLink.style.display = 'none';
                }

                if (coachCountries[selectedCoach]) {
                    document.getElementById('country').value = coachCountries[selectedCoach];
                }
            }
        }

        function clearHours() {
            const tableBody = document.getElementById('hoursTable').querySelector('tbody');
            while (tableBody.firstChild) {
                tableBody.removeChild(tableBody.firstChild);
            }
            document.getElementById('date').value = '';
            document.getElementById('coach').value = '';
            document.getElementById('country').value = '';
            document.getElementById('hours').value = '';
            document.getElementById('duracion').value = '';
            document.getElementById('note').value = '';

            const deleteHourSelect = document.getElementById('deleteHour');
            deleteHourSelect.innerHTML = '';

            document.getElementById('portal').value = ''; 
            document.getElementById('password').value = ''; 
            document.getElementById('zoom').value = ''; 
            document.getElementById('zoomPassword').value = ''; 
        }

        function adjustTime(time, country) {
            const result = {};
            const [hours, minutes] = time.split(':').map(Number);
            const baseTime = new Date();
            baseTime.setUTCHours(hours - timeZones[country], minutes);

            for (const [countryName, offset] of Object.entries(timeZones)) {
                const localTime = new Date(baseTime);
                localTime.setUTCHours(localTime.getUTCHours() + offset);
                const localHours = String(localTime.getUTCHours()).padStart(2, '0');
                const localMinutes = String(localTime.getUTCMinutes()).padStart(2, '0');
                result[countryName] = `${localHours}:${localMinutes}`;
            }

            return result;
        }

        let existingEntries = [];

        async function addHour() {
            const hours = document.getElementById('hours').value;
            const duration = document.getElementById('duracion').value;
            const date = document.getElementById('date').value;
            const coach = document.getElementById('coach').value;
            const country = document.getElementById('country').value;

            if (!hours || !duration || !date || !coach || !country) {
                alert('Por favor, complete todos los campos.');
                return;
            }

            const duplicate = existingEntries.find(entry =>
                entry.coach === coach &&
                entry.fecha === date &&
                entry.horaRD === hours
            );

            if (duplicate) {
                alert('Ya existe un registro con los mismos datos en la tabla.');
                return;
            }

            const filterFormula = `AND({Coach Solicitante}="${coach}", {Fecha}="${date}", {Hora Republica Dominicana}="${hours}")`;

            try {
                const response = await fetch(`${apiUrl}/Independientes 2.0?filterByFormula=${encodeURIComponent(filterFormula)}`, {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${apiKey}`,
                        'Content-Type': 'application/json'
                    }
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    console.error('Error al verificar los datos en Airtable:', errorData);
                    alert('Error al verificar los datos en Airtable: ' + JSON.stringify(errorData));
                    return;
                }

                const data = await response.json();

                if (data.records.length > 0) {
                    alert('Ya existe un registro en Airtable con el mismo Coach, Fecha y Hora de RD. No se puede agregar esta fila.');
                    return;
                }

            } catch (error) {
                console.error('Error al verificar los datos en Airtable:', error);
                alert('Error al verificar los datos en Airtable.');
                return;
            }

            const adjustedTimes = adjustTime(hours, country);
            const newRow = document.createElement('tr');

            newRow.innerHTML = `
                <td>${hours}</td>
                <td>${duration} minutos</td>
                <td>
                    <select class="coachSelect">
                        <option value="No Remplazo">Sin Reemplazo</option>
                    </select>
                    <input type="text" class="newCoachName" placeholder="Ingrese nuevo nombre" style="display: none;">
                </td>
                <td>
                    <select>
                        <option value="Interno">Interno</option>
                        <option value="Externo">Externo</option>
                    </select>
                </td>
                <td>${adjustedTimes['España']}</td>
                <td>${adjustedTimes['Panamá']}</td>
                <td>${adjustedTimes['EST']}</td>
                <td>${adjustedTimes['República Dominicana']}</td>
                <td>${adjustedTimes['Argentina']}</td>
                <td>${adjustedTimes['Costa Rica']}</td>
                <td>${adjustedTimes['Guatemala']}</td>
                <td>${adjustedTimes['Nicaragua']}</td>
                <td>${adjustedTimes['Chile']}</td>
                <td>${date}</td>
            `;

            const today = new Date().toISOString().split('T')[0];
            if (date < today) {
                newRow.style.backgroundColor = 'red';
                alert('La fecha ingresada es pasada. La fila se ha marcado en rojo. Por favor, elimine esa fila.');
            }

            document.getElementById('hoursTable').querySelector('tbody').appendChild(newRow);

            const deleteHourSelect = document.getElementById('deleteHour');
            const newOption = document.createElement('option');
            newOption.value = hours;
            newOption.text = hours;
            deleteHourSelect.appendChild(newOption);

            existingEntries.push({ coach, fecha: date, horaRD: hours });
        }

        async function saveData() {
            const coach = document.getElementById('coach').value;
            const country = document.getElementById('country').value;
            const note = document.getElementById('note').value;

            const rows = document.getElementById('hoursTable').getElementsByTagName('tbody')[0].rows;

            for (let row of rows) {
                const coachSolicitante = coach;
                const fecha = row.cells[13].innerText;
                const horaRD = row.cells[7].innerText;

                const filterFormula = `AND({Coach Solicitante}="${coachSolicitante}", {Fecha}="${fecha}", {Hora Republica Dominicana}="${horaRD}")`;

                try {
                    const response = await fetch(`${apiUrl}/Independientes 2.0?filterByFormula=${encodeURIComponent(filterFormula)}`, {
                        method: 'GET',
                        headers: {
                            'Authorization': `Bearer ${apiKey}`,
                            'Content-Type': 'application/json'
                        }
                    });

                    if (!response.ok) {
                        const errorData = await response.json();
                        console.error('Error al verificar los datos en Airtable:', errorData);
                        alert('Error al verificar los datos en Airtable: ' + JSON.stringify(errorData));
                        return;
                    }

                    const data = await response.json();

                    if (data.records.length > 0) {
                        alert(`Ya existe un registro en Airtable con el Coach ${coachSolicitante}, la Fecha ${fecha} y la Hora de RD ${horaRD}. No se puede guardar un duplicado.`);
                        return;
                    }

                } catch (error) {
                    console.error('Error al verificar los datos en Airtable:', error);
                    alert('Error al verificar los datos en Airtable.');
                    return;
                }
            }

            let records = [];

            for (let row of rows) {
                records.push({
                    fields: {
                        "Coach Solicitante": coach,
                        "País": country,
                        "Duración": row.cells[1].innerText,
                        "Coach de Reemplazo": row.cells[2].getElementsByTagName('select')[0].value,
                        "Tipo de Reemplazo": row.cells[3].getElementsByTagName('select')[0].value,
                        "Hora España": row.cells[4].innerText,
                        "Hora Panamá": row.cells[5].innerText,
                        "Hora EST": row.cells[6].innerText,
                        "Hora Republica Dominicana": row.cells[7].innerText,
                        "Hora Argentina": row.cells[8].innerText,
                        "Hora Costa Rica": row.cells[9].innerText,
                        "Hora Guatemala": row.cells[10].innerText,
                        "Hora Nicaragua": row.cells[11].innerText,
                        "Hora Chile": row.cells[12].innerText,
                        "Fecha": row.cells[13].innerText,
                        "Nota": note
                    }
                });
            }

            try {
                const response = await fetch(`${apiUrl}/Independientes 2.0`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${apiKey}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ records })
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    console.error('Error al guardar los datos:', errorData);
                    alert('Error al guardar los datos: ' + JSON.stringify(errorData));
                } else {
                    const data = await response.json();
                    console.log('Datos guardados con éxito:', data);
                    alert('Datos guardados con éxito.');
                    clearForm();
                }
            } catch (error) {
                console.error('Error al guardar los datos:', error);
                alert('Error al guardar los datos.');
            }
        }

        function clearForm() {
            document.getElementById('coach').value = '';
            document.getElementById('country').value = '';
            document.getElementById('note').value = '';
            document.getElementById('hours').value = '';
            document.getElementById('duracion').value = '';
            document.getElementById('date').value = '';

            const tableBody = document.getElementById('hoursTable').getElementsByTagName('tbody')[0];
            while (tableBody.firstChild) {
                tableBody.removeChild(tableBody.firstChild);
            }

            const deleteHourSelect = document.getElementById('deleteHour');
            deleteHourSelect.innerHTML = '';
        }

        const apiUrl = 'https://api.airtable.com/v0/appVuMTXFU8YHrGND';
        const apiKey = 'pat9wBOS3cEULZjbM.46a19c678b7b3a403febb212e0ec73de16f408d4193bf476a5d7348c23be39b1';
       
        async function searchRecords() {
            const coach = document.getElementById('coach').value;

            if (!coach) {
                alert('Por favor, selecciona un Coach.');
                return;
            }

            const filterFormula = `{Coach Solicitante}="${coach}"`;

            try {
                const response = await fetch(`${apiUrl}/Independientes 2.0?filterByFormula=${encodeURIComponent(filterFormula)}`, {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${apiKey}`,
                        'Content-Type': 'application/json'
                    }
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    console.error('Error al buscar los datos:', errorData);
                    alert('Error al buscar los datos: ' + JSON.stringify(errorData));
                } else {
                    const data = await response.json();
                    console.log('Datos recibidos:', data);

                    const tableBody = document.getElementById('hoursTable').getElementsByTagName('tbody')[0];
                    tableBody.innerHTML = '';

                    if (data.records.length === 0) {
                        alert('No se encontraron registros.');
                    } else {
                        data.records.forEach(record => {
                            const row = tableBody.insertRow();
                            row.setAttribute('data-record-id', record.id);

                            row.insertCell(0).innerText = record.fields["Hora"] || '';
                            row.insertCell(1).innerText = record.fields["Duración"] || '';

                            const coachCell = row.insertCell(2);
                            const coachSelect = document.createElement('select');
                            coachSelect.classList.add('coachSelect');
                            const coaches = [
                                "No Remplazo", "Josue Avila", "Magnolia Zuñiga", "Juan Rodríguez", "Daniela Fernandez",
                                "Cristian Arriagada", "Edwin Juarez", "Fernanda Ortiz", "Valentina Cornejo","Francheska Santiago","Laura","Tatitana","Valde Pie", "Otro"
                            ];
                            coaches.forEach(coachName => {
                                const option = document.createElement('option');
                                option.value = coachName;
                                option.text = coachName;
                                coachSelect.appendChild(option);
                            });
                            coachSelect.value = record.fields["Coach de Reemplazo"] || "No Remplazo";
                            coachCell.appendChild(coachSelect);

                            const newCoachInput = document.createElement('input');
                            newCoachInput.type = 'text';
                            newCoachInput.classList.add('newCoachName');
                            newCoachInput.placeholder = "Ingrese nuevo nombre";
                            newCoachInput.style.display = 'none';
                            coachCell.appendChild(newCoachInput);

                            coachSelect.addEventListener('change', function() {
                                if (coachSelect.value === 'Otro') {
                                    newCoachInput.style.display = 'block';
                                } else {
                                    newCoachInput.style.display = 'none';
                                }
                            });

                            const tipoReemplazoCell = row.insertCell(3);
                            const tipoReemplazoSelect = document.createElement('select');
                            ["Interno", "Externo"].forEach(tipo => {
                                const option = document.createElement('option');
                                option.value = tipo;
                                option.text = tipo;
                                tipoReemplazoSelect.appendChild(option);
                            });
                            tipoReemplazoSelect.value = record.fields["Tipo de Reemplazo"] || "Interno";
                            tipoReemplazoCell.appendChild(tipoReemplazoSelect);

                            row.insertCell(4).innerText = record.fields["Hora España"] || '';
                            row.insertCell(5).innerText = record.fields["Hora Panamá"] || '';
                            row.insertCell(6).innerText = record.fields["Hora EST"] || '';
                            row.insertCell(7).innerText = record.fields["Hora Republica Dominicana"] || '';
                            row.insertCell(8).innerText = record.fields["Hora Argentina"] || '';
                            row.insertCell(9).innerText = record.fields["Hora Costa Rica"] || '';
                            row.insertCell(10).innerText = record.fields["Hora Guatemala"] || '';
                            row.insertCell(11).innerText = record.fields["Hora Nicaragua"] || '';
                            row.insertCell(12).innerText = record.fields["Hora Chile"] || '';
                            row.insertCell(13).innerText = record.fields["Fecha"] || '';
                        });

                        if (data.records.length > 0) {
                            document.getElementById('note').value = data.records[data.records.length - 1].fields["Nota"] || '';
                        } else {
                            document.getElementById('note').value = '';
                        }

                        alert('Búsqueda completada con éxito.');
                    }
                }
            } catch (error) {
                console.error('Error:', error);
                alert('Error al buscar los datos.');
            }
        }

        async function replaceData() {
            const rows = document.getElementById('hoursTable').getElementsByTagName('tbody')[0].rows;
            let records = [];

            for (const row of rows) {
                const recordId = row.getAttribute('data-record-id');
                const coachReemplazo = row.cells[2].getElementsByTagName('select')[0].value;
                const tipoReemplazo = row.cells[3].getElementsByTagName('select')[0].value;

                try {
                    const response = await fetch(`${apiUrl}/Independientes 2.0/${recordId}`, {
                        method: 'GET',
                        headers: {
                            'Authorization': `Bearer ${apiKey}`,
                            'Content-Type': 'application/json'
                        }
                    });

                    if (!response.ok) {
                        console.error('Error al obtener datos:', await response.json());
                        alert(`Error al obtener datos para la fila con ID: ${recordId}`);
                        continue;
                    }

                    const data = await response.json();
                    const originalCoachReemplazo = data.fields["Coach de Reemplazo"];

                    if (originalCoachReemplazo !== "No Remplazo" && coachReemplazo !== "No Remplazo") {
                        const password = prompt(`Por favor, ingresa la contraseña o comuniquese con su C.A. (Josue Avila)`);
                        if (password !== "AvilaCA2.0") {
                            alert(`Contraseña incorrecta, No se le asignara el coach seleccionado`);
                            continue;
                        }
                    }

                    records.push({
                        id: recordId,
                        fields: {
                            "Coach de Reemplazo": coachReemplazo,
                            "Tipo de Reemplazo": tipoReemplazo
                        }
                    });

                } catch (error) {
                    console.error('Error:', error);
                    alert(`Error al procesar la fila `);
                }
            }

            if (records.length === 0) {
                alert('No se encontraron cambios para reemplazar.');
                return;
            }

            for (let i = 0; i < records.length; i += 10) {
                const batch = records.slice(i, i + 10);

                try {
                    const response = await fetch(`${apiUrl}/Independientes 2.0`, {
                        method: 'PATCH',
                        headers: {
                            'Authorization': `Bearer ${apiKey}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ records: batch })
                    });

                    if (!response.ok) {
                        const errorData = await response.json();
                        console.error('Error al reemplazar los datos:', errorData);
                        alert('Error al reemplazar los datos: ' + JSON.stringify(errorData));
                    } else {
                        const data = await response.json();
                        console.log('Datos reemplazados con éxito:', data);
                        alert('Datos reemplazados con éxito.');
                    }
                } catch (error) {
                    console.error('Error:', error);
                    alert('Error al reemplazar los datos.');
                }
            }
        }

        function showDeleteHourOptions() {
            document.getElementById('deleteOptions').style.display = 'block';
        }

        function removeSelectedHours() {
            const deleteHourSelect = document.getElementById('deleteHour');
            const selectedHour = deleteHourSelect.value;

            if (selectedHour) {
                const rows = document.getElementById('hoursTable').querySelectorAll('tbody tr');
                for (const row of rows) {
                    if (row.cells[0].textContent === selectedHour) {
                        row.remove();
                        break;
                    }
                }

                deleteHourSelect.remove(deleteHourSelect.selectedIndex);
            }
        }

        function checkPassword() {
            const password = prompt("Por favor, ingrese la contraseña:");

            if (password === "AvilaCA2.0") {
                window.location.href = "https://airtable.com/invite/l?inviteId=invA8e6daTOpZiTDg&inviteToken=be6726c106c0efe782e36ac24f147d7ca3634c334e0b721aa8a8714da5fe757f&utm_medium=email&utm_source=product_team&utm_content=transactional-alerts";
            } else {
                alert("Contraseña incorrecta.");
            }
        }
        const express = require("express");
const axios = require("axios");

const app = express();

// Configuración del puerto
const PORT = 3000;
app.listen(PORT, () => {
    console.log(`Servidor proxy ejecutándose en http://localhost:${PORT}`);
});


// Claves y URL de la API de Airtable
const AIRTABLE_API_URL = "https://api.airtable.com/v0/appVuMTXFU8YHrGND/Independientes%202.0";
const AIRTABLE_API_KEY = "tu_api_key_aqui"; // Reemplaza con tu API Key real

// Endpoint para obtener datos por grupo
app.get("/airtable", async (req, res) => {
    const group = req.query.group; // Leer el parámetro "group" de la URL
    if (!group) {
        return res.status(400).send({ error: "Falta el parámetro 'group'" });
    }

    try {
        // Hacer la solicitud a Airtable
        const response = await axios.get(AIRTABLE_API_URL, {
            params: {
                filterByFormula: `{Grupo}="${group}"` // Filtrar por el grupo dinámico
            },
            headers: {
                Authorization: `Bearer ${AIRTABLE_API_KEY}`
            }
        });

        // Enviar la respuesta JSON al cliente
        res.json(response.data);
    } catch (error) {
        console.error("Error al obtener datos de Airtable:", error.message);
        res.status(500).send({ error: "Error al obtener datos de Airtable" });
    }
});

// Iniciar el servidor
app.listen(PORT, () => {
    console.log(`Servidor proxy ejecutándose en http://localhost:${PORT}`);
});
 </script>
</body>
</html>